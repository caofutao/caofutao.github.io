<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[NSURLProtocolé»‘é­”æ³•]]></title>
    <url>%2F2017%2F06%2F29%2FNSURLProtocol%E9%BB%91%E9%AD%94%E6%B3%95%2F</url>
    <content type="text"><![CDATA[å†™åœ¨å‰é¢çš„è¯ å®žé™…åº”ç”¨ï¼šåœ¨å…¬å¸çš„æµ·å¤–é¡¹ç›®ä¸­ï¼Œåœ¨Appä¸­åµŒå…¥YouTubeç½‘é¡µï¼Œå½“è¿›å…¥ä¸€ä¸ªè§†é¢‘è¯¦æƒ…é¡µæ—¶ï¼Œè§†é¢‘ä¼šè‡ªåŠ¨æ’­æ”¾ã€‚è€Œéœ€æ±‚æ˜¯ä¸è¦è‡ªåŠ¨æ’­æ”¾ï¼Œè®©ç”¨æˆ·ç‚¹å‡»æˆ‘ä»¬è‡ªå®šä¹‰çš„æ’­æ”¾æŒ‰é’®æŠŠè§†é¢‘æŠ•åˆ°ç”µè§†ä¸Šæ’­æ”¾ã€‚ä¸‹é¢è®©æˆ‘ä»¬ä¸€èµ·å­¦ä¹ ä¸‹å¦‚ä½•æ‹¦æˆªç½‘ç»œè¯·æ±‚ã€‚ URL Loading Systemå¦‚å›¾æ‰€ç¤ºï¼ŒURL Loading Systemæ˜¯iOSä¸€ç³»åˆ—ç½‘ç»œè¯·æ±‚ç±»çš„é›†åˆï¼ŒåŒ…æ‹¬å·²ç»è¿‡æœŸä¸ç”¨çš„NSConnectionå’ŒçŽ°åœ¨æµè¡Œçš„NSURLSessionï¼Œè¿˜åŒ…æ‹¬ä¸€äº›è¯·æ±‚è®¤è¯çš„ç±»ï¼Œä¸€ä¸ªsessionConfigçš„ç±»ï¼Œè¿˜æœ‰å…³äºŽå¤„ç†è¯·æ±‚ç¼“å­˜çš„ç±»ç­‰ï¼Œå½“ç„¶è¿˜åŒ…æ‹¬æˆ‘ä»¬è¦è¯´çš„è¿™ä¸ªNSURLProtocolç±»ã€‚ NSURLProtocol NSURLProtocolå¯ä»¥è®©æˆ‘ä»¬æ‹¦æˆªç¨‹åºä¸­çš„ä¸€åˆ‡ç½‘ç»œè¯·æ±‚ï¼Œå› ä¸ºNSURLProtocolæ˜¯ä¸€ä¸ªè™šåŸºç±»ï¼Œæ‰€ä»¥ä¸èƒ½ç›´æŽ¥ä½¿ç”¨å®ƒï¼Œè¦æƒ³ä½¿ç”¨å®ƒå°±å¿…é¡»è‡ªå®šä¹‰ä¸€ä¸ªç±»æˆä¸ºä»–çš„å­ç±»ï¼Œç„¶åŽå®žçŽ°ä»–é‡Œé¢çš„å¿…é¡»å®žçŽ°çš„ä¸€äº›æ–¹æ³•ã€‚ä¸»è¦è¿›è¡Œå¦‚ä¸‹æ‹¦æˆªå¤„ç†: è‡ªå®šä¹‰è¯·æ±‚ å’Œ å“åº” è¿‡æ»¤æŽ‰æŸäº›è¯·æ±‚ä¸è®©å…¶å‘èµ·ã€ä»¥åŠä¿®æ”¹ æä¾› è‡ªå®šä¹‰çš„å…¨å±€ç¼“å­˜ é€»è¾‘ é‡å®šå‘ ç½‘ç»œè¯·æ±‚ æä¾› HTTP Mocking (æ–¹ä¾¿å‰æœŸæµ‹è¯•) å¦‚ä½•æ‹¦æˆªç½‘ç»œè¯·æ±‚æ³¨å†Œè‡ªå®šä¹‰çš„URLProtocolå­ç±» åœ¨appDelegateä¸­ï¼Œæ³¨å†Œè‡ªå·±æ‹¦æˆªè¯·æ±‚çš„URLProtocolå­ç±»;ç›¸å¯¹åº”çš„ä¹Ÿæœ‰unregistClassæ–¹æ³•ï¼Œä¸è®©æŸä¸ªå­ç±»èµ·ä½œç”¨ 123456- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions &#123; [NSURLProtocol registerClass:[WSURLProtocol class]]; return YES;&#125; å­ç±»å¿…é¡»å®žçŽ°çš„æ–¹æ³• + (BOOL)canInitWithRequest:(NSURLRequest *)requestæ¯æ¬¡æœ‰ä¸€ä¸ªè¯·æ±‚çš„æ—¶å€™éƒ½ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•é‡Œé¢åˆ¤æ–­è¿™ä¸ªè¯·æ±‚æ˜¯å¦éœ€è¦è¢«å¤„ç†æ‹¦æˆªï¼Œå¦‚æžœè¿”å›žYESå°±ä»£è¡¨è¿™ä¸ªrequestéœ€è¦è¢«å¤„ç†ï¼Œåä¹‹å°±æ˜¯ä¸éœ€è¦è¢«å¤„ç†ã€‚ 1234567891011121314+ (BOOL)canInitWithRequest:(NSURLRequest *)request &#123; //åˆ¤æ–­æ˜¯å¦å¤„ç†è¿‡ï¼Œé˜²æ­¢æ­»å¾ªçŽ¯ if ([NSURLProtocol propertyForKey:protocolKey inRequest:request]) &#123; return NO; &#125; //åªæ‹¦æˆªhttpå’Œhttpsè¯·æ±‚ NSString *scheme = [[request URL] scheme]; if ([scheme caseInsensitiveCompare:@"http"] == NSOrderedSame || [scheme caseInsensitiveCompare:@"https"] == NSOrderedSame) &#123; return YES; &#125; return NO;&#125; + (NSURLRequest *) canonicalRequestForRequest:(NSURLRequest *)request é€šå¸¸è¯¥æ–¹æ³•ä½ å¯ä»¥ç®€å•çš„ç›´æŽ¥è¿”å›žrequestï¼Œä½†ä¹Ÿå¯ä»¥åœ¨è¿™é‡Œä¿®æ”¹requestï¼Œæ¯”å¦‚æ·»åŠ headerï¼Œä¿®æ”¹hostç­‰ï¼Œå¹¶è¿”å›žä¸€ä¸ªæ–°çš„requestï¼Œè¿™æ˜¯ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œå­ç±»å¿…é¡»å®žçŽ°ã€‚ 123456+ (NSURLRequest *)canonicalRequestForRequest: (NSURLRequest *)request &#123; NSMutableURLRequest *request = [request mutableCopy]; //æŠŠè®¿é—®ç™¾åº¦çš„requestæ”¹ä¸ºè®¿é—®Googleäº† request.URL = [NSURL URLWithString:@"http://www.google.com"]; return request;&#125; + (BOOL)requestIsCacheEquivalent:(NSURLRequest *)a toRequest:(NSURLRequest *)b å¯ç”¨æ¥ä½¿ç”¨ç¼“å­˜æ•°æ®ç»“æŸæ­¤æ¬¡ç½‘ç»œè¯·æ±‚ - (void)startLoading å¼€å§‹è¯·æ±‚ 123456789101112131415- (void)startLoading &#123; NSMutableURLRequest *request = [self.request mutableCopy]; // æ ‡è®°requestå·²å¤„ç† [NSURLProtocol setProperty:@(YES) forKey:protocolKey inRequest:request]; //ä½¿ç”¨NSURLSessionç»§ç»­æŠŠé‡å®šå‘çš„requestå‘é€å‡ºåŽ» NSURLSessionConfiguration *config = [NSURLSessionConfiguration ephemeralSessionConfiguration]; NSOperationQueue *mainQueue = [NSOperationQueue mainQueue]; NSURLSession *session = [NSURLSession sessionWithConfiguration:config delegate:self delegateQueue:mainQueue]; NSURLSessionDataTask *task = [session dataTaskWithRequest:request]; [task resume];&#125; -(void)stopLoading åœæ­¢è¯·æ±‚çš„æ–¹æ³•ï¼Œä¹Ÿæ˜¯è¦å®žçŽ°çš„ã€‚ NSURLProtocolClientå¦‚æžœæˆ‘ä»¬ä½¿ç”¨UIWebViewå‘é€ä¸€ä¸ªrequestï¼Œæ‹¦æˆªä»¥åŽå½“æˆ‘ä»¬ä½¿ç”¨NSURLSessionå‘å‡ºäº†requestï¼Œé‚£ä¹ˆè¿™ä¸ªrequestçš„responseæ˜¯æ— æ³•å›žåˆ°è¿™ä¸ªUIWebViewçš„ï¼Œå› ä¸ºå¯ä»¥ç†è§£æˆä¸æ˜¯åŒä¸€ä¸ªåœ°æ–¹å‘å‡ºçš„requestï¼Œè¿™ä¸ªresponseåªèƒ½æœ‰sessionæ¥å¤„ç†ï¼Œé‚£æˆ‘ä»¬æ€Žä¹ˆæ‰èƒ½è®©è¿™ä¸ªresponseå›žåˆ°åˆšå¼€å§‹çš„UIWebViewå‘¢ï¼Ÿ NSURLProtocolClientå°±å¯ä»¥çœ‹åšæ˜¯URL Loading Systemï¼Œæˆ‘ä»¬æŠŠresponseå‘Šè¯‰clientï¼Œä¹Ÿå°±æ˜¯URL Loading Systemï¼Œè®©ä»–æ¥ç»§ç»­å¤„ç†è¿™ä¸ªresponseï¼Œå› ä¸ºä¸€åˆ‡éƒ½æ˜¯åŸºäºŽURL Loading Systemå‘ç”Ÿçš„ï¼Œæ‰€ä»¥æŠŠresponseäº¤ç»™ä»–ï¼Œä»–ä¼šè‡ªåŠ¨å¤„ç†è¿™ä¸ªresponseå›žåˆ°webViewã€‚ æ¯ä¸€ä¸ªNSURLProtocolçš„å­ç±»éƒ½æœ‰ä¸€ä¸ªclientå¯¹è±¡æ¥å¤„ç†è¯·æ±‚å¾—åˆ°çš„responseã€‚å…¶å®žä¸‹é¢è¿™äº›å†™æ³•éƒ½æ˜¯å·®ä¸å¤šå›ºå®šçš„ã€‚ 12345678910111213141516171819-(void)URLSession:(NSURLSession *)session task:(NSURLSessionTask *)task didCompleteWithError:(NSError *)error &#123; if (error) &#123; [self.client URLProtocol:self didFailWithError:error]; &#125; else &#123; [self.client URLProtocolDidFinishLoading:self]; &#125;&#125;-(void)URLSession:(NSURLSession *)session dataTask:(NSURLSessionDataTask *)dataTask didReceiveResponse:(NSURLResponse *)response completionHandler:(void (^)(NSURLSessionResponseDisposition))completionHandler &#123; [self.client URLProtocol:self didReceiveResponse:response cacheStoragePolicy:NSURLCacheStorageNotAllowed]; completionHandler(NSURLSessionResponseAllow);&#125;-(void)URLSession:(NSURLSession *)session dataTask:(NSURLSessionDataTask *)dataTask didReceiveData:(NSData *)data &#123; [self.client URLProtocol:self didLoadData:data];&#125;- (void)URLSession:(NSURLSession *)session dataTask:(NSURLSessionDataTask *)dataTask willCacheResponse:(NSCachedURLResponse *)proposedResponse completionHandler:(void (^)(NSCachedURLResponse *cachedResponse))completionHandler&#123; completionHandler(proposedResponse);&#125; æ€»ç»“ é˜²æ­¢æ­»å¾ªçŽ¯ [NSURLProtocol setProperty:@(YES) forKey:protocolKey inRequest:request]; NSURLProtocol å¯ä»¥æ‹¦æˆª NSURLConnectionã€NSURLSessionã€UIwebview çš„è¯·æ±‚ï¼Œä½†æ˜¯ä¸èƒ½æ‹¦æˆªWKwebview å’ŒCFNetworkçš„è¯·æ±‚ AFNetworking 3.0 ä»¥åŽç‰ˆæœ¬æ‹¦æˆªä¸åˆ°è¯·æ±‚ï¼Œsessionçš„åˆ›å»ºæ–¹å¼ä¸åŒï¼Œé»˜è®¤ä¸èµ·ä½œç”¨ï¼Œè§£å†³æ–¹æ³• å‚è€ƒç”°è…¾é£žçš„åšå®¢å¹»æƒ³ä¹¡]]></content>
      <tags>
        <tag>ç½‘ç»œ</tag>
        <tag>NSURLProtocol</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[TVOSå¼€å‘æŠ€å·§]]></title>
    <url>%2F2017%2F06%2F19%2FTVOS%E5%BC%80%E5%8F%91%E6%8A%80%E5%B7%A7%2F</url>
    <content type="text"><![CDATA[ç„¦ç‚¹ ImageViewè‡ªå¸¦focusç‰¹æ•ˆ guideFocus na]]></content>
      <tags>
        <tag>Swift</tag>
        <tag>TVOS</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[iOSåº”ç”¨å†…è´­ä¹°IAP]]></title>
    <url>%2F2017%2F06%2F13%2FiOS%E5%BA%94%E7%94%A8%E5%86%85%E8%B4%AD%E4%B9%B0IAP%2F</url>
    <content type="text"><![CDATA[iOSåº”ç”¨å†…è´­ä¹°IAP æœ€è¿‘è‹¹æžœé’ˆå¯¹iOSåº”ç”¨è½¯ä»¶å¼€å‘è€…çš„æŒ‡å¼•æ”¿ç­–è¿›è¡Œäº†ä¿®æ”¹ï¼Œï¼Œç¬¬ä¸€æ¬¡æ˜Žç¡®æŒ‡å‡ºç”¨æˆ·æ”¯ä»˜å°è´¹æˆ–è€…æ‰“èµï¼Œå¿…é¡»é€šè¿‡è‹¹æžœçš„æ”¯ä»˜æ¸ é“ï¼Œä¹Ÿå°±æ˜¯ä¸èƒ½ç»•å¼€è‹¹æžœiOSç®¡ç†æœºåˆ¶ã€‚å¾®ä¿¡åœ¨iOSç‰ˆæœ¬å–æ¶ˆäº†æ‰“èµåŠŸèƒ½ï¼ŒçŸ¥ä¹Žåˆ™æ˜¯å‘è‹¹æžœä½Žäº†å¤´â€¦è‹¹æžœåœ¨ç›¸å…³æ–‡æ¡£ä¸­æåˆ°ï¼Œå¦‚æžœå¼€å‘è€…æƒ³åœ¨iOSè½¯ä»¶æä¾›ä¸‹è¿°åŠŸèƒ½ï¼ˆæ¯”å¦‚ç”¨æˆ·è®¢é˜…ã€æ¸¸æˆå†…è™šæ‹Ÿè´§å¸ã€èŽ·å–é«˜ç«¯ä¼šå‘˜å†…å®¹ã€æˆ–è€…æä¾›å®Œæ•´çš„åŠŸèƒ½ç‰ˆæœ¬ç­‰ï¼‰ï¼Œåˆ™å¼€å‘è€…å¿…é¡»ä½¿ç”¨è½¯ä»¶å†…è´­ä¹°ã€‚ æœ¬æ–‡ä¸»è¦ä»¥è‡ªåŠ¨è®¢é˜…ç±»åž‹äº§å“ä¸ºä¸»ï¼Œå…¶ä»–ç±»åž‹äº§å“ä¸ºè¾… å‡†å¤‡In-App Purchaseï¼Œ ç®€ç§°IAPï¼Œå…è®¸åœ¨iOS appä¸ŽmacOS appä¸­å‡ºå”®å•†å“ã€‚ æ–°å»ºä¸€ä¸ªappï¼Œç„¶åŽæ·»åŠ App å†…è´­ä¹°é¡¹ç›®ï¼Œä¸»è¦åˆ†å››ç§å†…è´­ä¹°é¡¹ç›®ç±»åž‹ã€‚ æ¶ˆè€—å“ï¼ˆConsumable productsï¼‰ï¼šä¼šè¶Šç”¨è¶Šå°‘çš„ï¼Œæ¯”å¦‚æ¸¸æˆå†…é‡‘å¸ç­‰ã€‚ ä¸å¯æ¶ˆè€—å“ï¼ˆNon-consumable productsï¼‰ï¼šæ¯”å¦‚æ¸¸æˆä¸­è·‘è½¦ï¼Œç®€å•æ¥è¯´å°±æ˜¯ä¸€æ¬¡è´­ä¹°ï¼Œç»ˆèº«å¯ç”¨ï¼ˆç”¨æˆ·å¯éšæ—¶ä»ŽApp Store restoreï¼‰ è‡ªåŠ¨æ›´æ–°è®¢é˜…å“ï¼ˆAuto-renewable subscriptionsï¼‰ï¼šå’Œä¸å¯æ¶ˆè€—å“çš„ä¸åŒç‚¹æ˜¯æœ‰å¤±æ•ˆæ—¶é—´ã€‚æ¯”å¦‚ä¸€æ•´å¹´çš„ä»˜è´¹å‘¨åˆŠã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œå¼€å‘è€…å®šæœŸæŠ•é€’å†…å®¹ï¼Œç”¨æˆ·åœ¨è®¢é˜…æœŸå†…éšæ—¶å¯ä»¥è®¿é—®è¿™äº›å†…å®¹ã€‚è®¢é˜…å¿«è¦è¿‡æœŸæ—¶ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨æ›´æ–°è®¢é˜…ã€‚ éžè‡ªåŠ¨æ›´æ–°è®¢é˜…å“ï¼ˆNon-renewable subscriptionsï¼‰ï¼šä¸€èˆ¬ä½¿ç”¨åœºæ™¯æ˜¯ä»Žç”¨æˆ·ä»ŽIAPè´­ä¹°åŽï¼Œè´­ä¹°ä¿¡æ¯å­˜æ”¾åœ¨è‡ªå·±çš„å¼€å‘è€…æœåŠ¡å™¨ä¸Šã€‚å¤±æ•ˆæ—¥æœŸ/å¯ç”¨æ˜¯ç”±å¼€å‘è€…æœåŠ¡å™¨è‡ªè¡ŒæŽ§åˆ¶çš„ï¼Œè€Œéžç”±App StoreæŽ§åˆ¶ï¼Œè¿™ä¸€ç‚¹ä¸Žè‡ªåŠ¨æ›´æ–°è®¢é˜…å“æœ‰å·®å¼‚ã€‚ æ·»åŠ APPå†…è´­ä¹°é¡¹ç›® è®¾ç½®ç¨ŽåŠ¡å’Œé“¶è¡Œå¡ä¿¡æ¯ æ·»åŠ æ²™ç›’æµ‹è¯•è´¦å· ä½¿ç”¨StoreKit API èŽ·å–äº§å“åˆ—è¡¨ï¼Œå±•çŽ°çš„äº§å“å¯ä»¥åŽå°é…ç½®(Consumableå¯æ¶ˆè€—å•†å“ä¸¾ä¾‹) 12345678910111213141516171819202122232425262728293031323334// MARK: - FETCH AVAILABLE IAP PRODUCTS func fetchAvailableProducts() &#123; Toast(text: "fetching available products").show() // Put here your IAP Products ID's let productIdentifiers = NSSet(objects: COINS_PRODUCT_ID,PREMIUM_PRODUCT_ID ) productsRequest = SKProductsRequest(productIdentifiers: productIdentifiers as! Set&lt;String&gt;) productsRequest.delegate = self productsRequest.start() &#125; // MARK: - REQUEST IAP PRODUCTS func productsRequest (_ request:SKProductsRequest, didReceive response:SKProductsResponse) &#123; if (response.products.count &gt; 0) &#123; Toast(text: "fetch \(response.products.count) product success").show() iapProducts = response.products // 1st IAP Product (Consumable) ------------------------------------ let firstProduct = response.products[0] as SKProduct // Get its price from iTunes Connect let numberFormatter = NumberFormatter() numberFormatter.formatterBehavior = .behavior10_4 numberFormatter.numberStyle = .currency numberFormatter.locale = firstProduct.priceLocale let price1Str = numberFormatter.string(from: firstProduct.price) // Show its description consumableLabel.text = firstProduct.localizedDescription + "\nfor just \(price1Str!)" &#125; &#125; è´­ä¹°äº§å“ï¼Œé¦–å…ˆæ£€æŸ¥è®¾å¤‡æ˜¯å¦æ”¯æŒå†…è´­ä¹°ï¼Œç„¶åŽå°†äº¤æ˜“åŠ å…¥æ”¯ä»˜é˜Ÿåˆ— 123456789101112131415161718192021// MARK: - MAKE PURCHASE OF A PRODUCT func canMakePurchases() -&gt; Bool &#123; return SKPaymentQueue.canMakePayments() &#125; func purchaseMyProduct(product: SKProduct) &#123; if self.canMakePurchases() &#123; Toast(text: "begin purchase for \(product.localizedTitle)").show() let payment = SKPayment(product: product) SKPaymentQueue.default().add(self) SKPaymentQueue.default().add(payment) print("PRODUCT TO PURCHASE: \(product.productIdentifier)") productID = product.productIdentifier // IAP Purchases dsabled on the Device &#125; else &#123; UIAlertView(title: "IAP Tutorial", message: "Purchases are disabled in your device!", delegate: nil, cancelButtonTitle: "OK").show() &#125; &#125; å¤„ç†æ”¯ä»˜ç»“æžœ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354// MARK:- IAP PAYMENT QUEUE func paymentQueue(_ queue: SKPaymentQueue, updatedTransactions transactions: [SKPaymentTransaction]) &#123; for transaction:AnyObject in transactions &#123; if let trans = transaction as? SKPaymentTransaction &#123; let msg = self.descFromTransactionState(trans.transactionState); if(msg != nil)&#123; Toast(text: msg).show() &#125; switch trans.transactionState &#123; case .purchased: SKPaymentQueue.default().finishTransaction(transaction as! SKPaymentTransaction) guard let receiptUrl = Bundle.main.appStoreReceiptURL else &#123; SKPaymentQueue.default() return &#125; let receipt = try? Data.init(contentsOf: receiptUrl) //è‡ªåŠ¨è®¢é˜…ç±»åž‹éœ€è¦éªŒè¯receipt å‘åˆ° apple guard let receiptBase64String = receipt?.base64EncodedString() else &#123; return &#125; let dict = ["receipt-data": receiptBase64String] let url:URL? = URL(string:"https://sandbox.itunes.apple.com/verifyReceipt") var request = URLRequest.init(url: url!) request.httpMethod = "POST" let data = try? JSONSerialization.data(withJSONObject: dict, options: JSONSerialization.WritingOptions.prettyPrinted) request.httpBody = data URLSession.shared.dataTask(with: request, completionHandler: &#123; (data, response, error) in if(data != nil)&#123; let JSONObj = try? JSONSerialization.jsonObject(with: data!, options: .allowFragments) let str = String(data: data!, encoding: .utf8) print(str!) print(JSONObj!) &#125; &#125;).resume() break case .failed: SKPaymentQueue.default().finishTransaction(transaction as! SKPaymentTransaction) break case .restored: SKPaymentQueue.default().finishTransaction(transaction as! SKPaymentTransaction) break default: break &#125;&#125;&#125; &#125; ä½¿ç”¨SwiftyStoreKitåº“ç®€åŒ–è°ƒç”¨API SwiftyStoreKitå¯¹StoreKitçš„apiè¿›è¡Œå°è£…ï¼Œè°ƒç”¨èµ·æ¥æ›´åŠ æ–¹ä¾¿ã€‚å…·ä½“apiè¯·å‚è€ƒSwiftyStoreKit Github éœ€è¦æ³¨æ„çš„è´­ä¹°å•†å“æ—¶api åŒºåˆ†åŽŸå­æ€§å’ŒéžåŽŸå­æ€§ï¼›åŽŸå­æ€§æ˜¯è´­ä¹°æˆåŠŸåŽï¼Œè´­ä¹°çš„å†…å®¹èƒ½ç«‹å³ä¼ é€’ç»™ç”¨æˆ·ç•Œé¢ï¼Œè€ŒéžåŽŸå­æ€§æ˜¯æŒ‡è´­ä¹°çš„å†…å®¹éœ€è¦ä»ŽæœåŠ¡å™¨ä¸‹è½½ï¼Œéœ€è¦ä¸‹è½½å®Œæ¯•ï¼Œæ‰è°ƒç”¨å®Œæˆäº¤æ˜“çš„apiæ¥ç»“æŸäº¤æ˜“ 12345678910111213141516171819202122SwiftyStoreKit.purchaseProduct("com.musevisions.SwiftyStoreKit.Purchase1", quantity: 1, atomically: false) &#123; result in switch result &#123; case .success(let product): // fetch content from your server, then: if product.needsFinishTransaction &#123; SwiftyStoreKit.finishTransaction(product.transaction) &#125; print("Purchase Success: \(product.productId)") case .error(let error): switch error.code &#123; case .unknown: print("Unknown error. Please contact support") case .clientInvalid: print("Not allowed to make the payment") case .paymentCancelled: break case .paymentInvalid: print("The purchase identifier was invalid") case .paymentNotAllowed: print("The device is not allowed to make the payment") case .storeProductNotAvailable: print("The product is not available in the current storefront") case .cloudServicePermissionDenied: print("Access to cloud service information is not allowed") case .cloudServiceNetworkConnectionFailed: print("Could not connect to the network") case .cloudServiceRevoked: print("User has revoked permission to use this cloud service") &#125; &#125;&#125; è‡ªåŠ¨è®¢é˜…ç±»åž‹æ€»ç»“ æ³¨å†Œåœ¨AppDelegateä¸­didFinishLaunchingWithOptionsä¸­ï¼Œæ³¨å†Œäº¤æ˜“è§‚å¯Ÿè€…ï¼Œè¿™æ ·appå°±å¯ä»¥æ”¶åˆ°æ”¯ä»˜é˜Ÿåˆ—çš„é€šçŸ¥ï¼ˆè‡ªåŠ¨ç»­è®¢æ—¶ä¼šè¢«è°ƒç”¨ï¼‰ æ²™ç›’æµ‹è¯•å‘¨æœŸä¼šè¢«åŠ é€Ÿï¼Œè®¢é˜…å‘¨æœŸä¸º1å‘¨ï¼Œåœ¨æ²™ç›’çŽ¯å¢ƒä¸‹åªéœ€3åˆ†é’Ÿï¼Œ1ä¸ªæœˆåªéœ€5åˆ†é’Ÿâ€¦è‹¹æžœè€ƒè™‘çš„æŒºå‘¨åˆ°çš„ ä¸€ä¸ªæ²™ç›’æµ‹è¯•è´¦å·ä¸€å¤©åªèƒ½è¢«æ›´æ–°è®¢é˜…5æ¬¡ï¼Œæµ‹è¯•è‡ªåŠ¨è®¢é˜…æ—¶å°¤å…¶æ³¨æ„ï¼Œå¯ä»¥ä½¿ç”¨å¤šä¸ªæµ‹è¯•è´¦å·ï¼ˆå½“æ—¶æˆ‘ä»¥ä¸ºæ²¡èƒ½è‡ªåŠ¨è®¢é˜…å‘¢ï¼‰ å®¢æˆ·ç«¯å…ˆå°†receiptå‘ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯åŽ»éªŒè¯receipt æœ‰æ—¶è¿”å›ž 210007 çŠ¶æ€ç ï¼Œæ„å‘³ç€è¿™ä¸ªreceiptæ˜¯æµ‹è¯•çŽ¯å¢ƒçš„ï¼Œä½†å‘é€åˆ°äº†æ­£å¼çŽ¯å¢ƒhttps://buy.itunes.apple.com/verifyReceipã€‚è€Œä¸”å®¡æ ¸æ—¶ï¼Œè‹¹æžœäººå‘˜ä¹Ÿæ˜¯ç”¨æ²™ç›’çŽ¯å¢ƒæµ‹è¯•ï¼Œå¦‚ä½•åˆ‡æ¢æ­£å¼å’Œæµ‹è¯•çŽ¯å¢ƒå‘¢ï¼Ÿè§£å†³æ–¹æ¡ˆï¼šæœåŠ¡ç«¯å…ˆèµ°æ­£å¼çŽ¯å¢ƒï¼Œå¦‚æžœè¿”å›ž21007å°±å†èµ°æ²™ç›’çŽ¯å¢ƒåŽ»éªŒè¯ã€‚ å…³äºŽç”¨æˆ·é€€æ¬¾ï¼Œéœ€è¦æœåŠ¡ç«¯å®šæœŸåŽ»å‘App StoreåŽ»æ ¡éªŒreceiptï¼Œåœ¨è¿”å›žæ¥çš„æ•°æ®ä¸­æ£€æŸ¥æ˜¯å¦æœ‰ cancellation_date å­—æ®µï¼Œå¦‚æžœæœ‰å€¼ï¼Œåˆ™è´­ä¹°ä¸æˆç«‹ã€‚ æ¬¢è¿ŽæŒ‡æ­£ðŸ˜ å‚è€ƒIn-App Purchases in iOS With Swift 3è‹¹æžœæ–‡æ¡£ About In-App Purchaseè‹¹æžœæ–‡æ¡£ éªŒè¯Receipt]]></content>
      <tags>
        <tag>Swift</tag>
        <tag>IAP</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Value and Reference Type]]></title>
    <url>%2F2017%2F06%2F03%2FValue-and-Reference-Type%2F</url>
    <content type="text"><![CDATA[Swiftä¸­å€¼ç±»åž‹å’Œå¼•ç”¨ç±»åž‹æœ¬æ–‡ä¸»è¦ä»‹ç»å€¼ç±»åž‹ã€ä»¥åŠä½¿ç”¨Structä½œä¸ºæ•°æ®æ¨¡åž‹çš„æ³¨æ„äº‹é¡¹ å€¼ç±»åž‹ï¼ˆvalue typeï¼‰å€¼ç±»åž‹ï¼šæ¯æ¬¡åˆ†é…ç»™å˜é‡/å¸¸é‡æˆ–è€…ä½œä¸ºå‚æ•°ä¼ é€’åˆ°å‡½æ•°æ—¶ï¼Œéƒ½ä¼šé‡æ–°åˆ›å»ºï¼ˆå¤åˆ¶ï¼‰ä¸€ä¸ªæ–°çš„å®žä¾‹ã€‚ Swift ä¸­çš„æ‰€æœ‰çš„å†…å»ºç±»åž‹éƒ½æ˜¯å€¼ç±»åž‹ï¼Œä¸ä»…åŒ…æ‹¬äº†ä¼ ç»Ÿæ„ä¹‰åƒ Intï¼ŒDoubleè¿™äº›ï¼Œç”šè‡³è¿ž Stringï¼ŒArray ä»¥åŠ Dictionary éƒ½æ˜¯å€¼ç±»åž‹çš„(ä¸ŽOCä¸åŒ), swiftä¸­æ‰€æœ‰çš„Struct å’Œ enum éƒ½æ˜¯å€¼ç±»åž‹ï¼Œå€¼ç±»åž‹æ¯æ¬¡åˆå§‹åŒ–ä»¥åŽï¼Œå°†å®ƒåˆ†é…æˆ–è€…ä¼ é€’æ—¶ï¼Œå®žé™…ä¸Šæ˜¯åˆ†é…æˆ–ä¼ é€’äº†å®ƒçš„ä¸€ä¸ªæ‹·è´ã€‚ 1234567891011121314struct Point &#123; var x : Int var y : Int init(x:Int, y:Int) &#123; self.x = x self.y = y &#125;&#125; var aPoint = Point(x: 10, y: 10) var bPoint = aPoint bPoint.x = 5 print(aPoint) print(bPoint) æ‰“å°ç»“æžœ Point(x: 10, y: 10) Point(x: 5, y: 10) æ€»ç»“ï¼š èµ‹å€¼ç»™æ–°å˜é‡ï¼Œä¼šäº§ç”Ÿä¸€ä¸ªå•ç‹¬çš„ã€æ²¡æœ‰æ•°æ®å…±äº«çš„æ–°å®žä¾‹. å€¼ç±»åž‹åœ¨å¤åˆ¶æ—¶ï¼Œä¼šå°†å­˜å‚¨åœ¨å…¶ä¸­çš„å€¼ç±»åž‹ä¸€å¹¶è¿›è¡Œå¤åˆ¶ï¼Œè€Œå¯¹äºŽå…¶ä¸­çš„å¼•ç”¨ç±»åž‹çš„è¯ï¼Œåˆ™åªå¤åˆ¶ä¸€ä»½å¼•ç”¨ã€‚ å¤åˆ¶æ—¶æœºï¼Œæ˜¯åœ¨å€¼ç±»åž‹ä¸­çš„å†…å®¹å‘ç”Ÿæ”¹å˜æ—¶ï¼å€¼ç±»åž‹æ¯æ¬¡å¤åˆ¶ä¼šå¢žåŠ é¢å¤–å¼€é”€ï¼ŒSwiftå°†è¿™ç§å¼€é”€æŽ§åˆ¶åœ¨æœ€å°çš„èŒƒå›´å†…ï¼Œåœ¨æ²¡æœ‰å¿…è¦å¤åˆ¶æ—¶ï¼Œå¤åˆ¶æ˜¯ä¸ä¼šå‘ç”Ÿçš„ã€‚~(â‰§â–½â‰¦)/~ çº¿ç¨‹å®‰å…¨ï¼š åœ¨Swiftä¸­ï¼ŒArrayã€Stringã€Dictionaryéƒ½æ˜¯å€¼ç±»åž‹ã€‚å®ƒä»¬çš„ä½¿ç”¨æ–¹å¼ç±»ä¼¼Cè¯­è¨€ä¸­å¾—intï¼Œæ¯ä¸€ä¸ªå®žä¾‹éƒ½æœ‰ä¸€ä»½æ•°æ®ã€‚ä½ ä¸éœ€è¦è¿›è¡Œæ˜¾ç¤ºçš„å¤åˆ¶æ“ä½œåŽ»é˜²æ­¢æ•°æ®åœ¨ä½ ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹è¢«ä¿®æ”¹ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œä½ å¯ä»¥è·¨çº¿ç¨‹è¿›è¡Œä¼ å‚è€Œä¸éœ€è¦è€ƒè™‘åŒæ­¥çš„é—®é¢˜ï¼Œå› ä¸ºä¼ é€’å€¼ç±»åž‹å¾ˆå®‰å…¨ã€‚ï¼ˆSwiftå®˜æ–¹åšå®¢ï¼‰ å¼•ç”¨ç±»åž‹ï¼ˆReference Typesï¼‰å¼•ç”¨ç±»åž‹ï¼šå¼•ç”¨ç±»åž‹åˆå§‹åŒ–åŽï¼Œæ— è®ºæ˜¯åˆ†é…ç»™å˜é‡è¿˜æ˜¯å¸¸é‡ï¼Œæˆ–æ˜¯é€šè¿‡å‚æ•°ä¼ é€’ç»™å‡½æ•°ï¼Œéƒ½å°†æ˜¯åŒä¸€ä¸ªå®žä¾‹å¯¹è±¡ã€‚NSObjectå†ç†Ÿæ‚‰ä¸è¿‡äº†ï¼Œå½“åœ¨åˆ†é…æˆ–ä¼ é€’æ˜¯éƒ½æ˜¯å¼•ç”¨ï¼Œéƒ½æŒ‡å‘é‚£ä¸ªåŽŸå§‹å¯¹è±¡ã€‚ä¸å†å¤šè¯´äº†~ Structæ•°æ®æ¨¡åž‹å¤„ç†æ•°æ®ç»“æž„æ—¶æœ‰æ—¶ä¼šç”¨Structè¿›è¡Œå¤„ç†ï¼Œä½¿ç”¨ Struct æ¥ä»£æ›¿ Class ä½œä¸ºæ•°æ®æ¨¡åž‹æœ‰å¾ˆå¤šå¥½å¤„ã€‚å€¼ç±»åž‹æ˜¯éžå¸¸æœ‰ä¼˜åŠ¿çš„ï¼š å®‰å…¨æ€§ ï¼šå› ä¸º Struct æ˜¯ç”¨å€¼ç±»åž‹ä¼ é€’çš„ï¼Œå®ƒä»¬æ²¡æœ‰å¼•ç”¨è®¡æ•°ã€‚ å†…å­˜ï¼šç”±äºŽä»–ä»¬æ²¡æœ‰å¼•ç”¨æ•°ï¼Œä»–ä»¬ä¸ä¼šå› ä¸ºå¾ªçŽ¯å¼•ç”¨å¯¼è‡´å†…å­˜æ³„æ¼ã€‚ é€Ÿåº¦ï¼šå€¼ç±»åž‹é€šå¸¸æ¥è¯´æ˜¯ä»¥æ ˆçš„å½¢å¼åˆ†é…çš„ï¼Œè€Œä¸æ˜¯ç”¨å †ã€‚å› æ­¤ä»–ä»¬æ¯” Class è¦å¿«å¾ˆå¤šï¼ŒçœŸçš„å¾ˆå¤šï¼åœ¨ StackOverflow ç»™ Struct å’Œ Class è¿›è¡Œç›¸åŒæ“ä½œçš„è¡¨çŽ°åšäº†åŸºå‡†æµ‹è¯•ï¼ŒStruct æ¯” Class è¦å¿«ä¹ç™¾å€ã€‚ æ‹·è´ï¼šåœ¨ Objective-C é‡Œæ‹·è´ä¸€ä¸ªå¯¹è±¡,ä½ å¿…é¡»é€‰ç”¨æ­£ç¡®çš„æ‹·è´ç±»åž‹ï¼ˆæ·±æ‹·è´ã€æµ…æ‹·è´ï¼‰ï¼Œè¿™æ˜¯éžå¸¸çƒ¦äººçš„ï¼Œå€¼ç±»åž‹çš„æ‹·è´åˆ™éžå¸¸è½»æ¾ï¼ çº¿ç¨‹å®‰å…¨ï¼šå€¼ç±»åž‹æ˜¯è‡ªåŠ¨çº¿ç¨‹å®‰å…¨çš„ã€‚æ— è®ºä½ ä»Žå“ªä¸ªçº¿ç¨‹åŽ»è®¿é—®ä½ çš„ Struct ï¼Œéƒ½éžå¸¸ç®€å•ã€‚ Structçš„ç¼ºç‚¹ï¼š OCæ— æ³•è°ƒç”¨Swiftçš„Structï¼Œå½“ä½ çš„é¡¹ç›®çš„ä»£ç æ˜¯ Swift å’Œ Objective-C æ··åˆå¼€å‘æ—¶ï¼Œä½ ä¼šå‘çŽ°åœ¨ Objective-C çš„ä»£ç é‡Œæ— æ³•è°ƒç”¨ Swift çš„ Structã€‚å› ä¸ºè¦åœ¨ Objective-C é‡Œè°ƒç”¨ Swift ä»£ç çš„è¯ï¼Œå¯¹è±¡éœ€è¦ç»§æ‰¿äºŽ NSObjectã€‚ ä¸èƒ½ç»§æ‰¿ï¼Œç»§æ‰¿æ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹çš„å››å¤§ç‰¹æ€§ä¹‹ä¸€ï¼Œæ²¡æœ‰ç»§æ‰¿å°±ä¸èƒ½æŠ½è±¡ä¸€ä¸ªç»Ÿä¸€æ¨¡åž‹ Struct ä¸èƒ½è¢«åºåˆ—åŒ–æˆ NSData å¯¹è±¡ã€‚æŸäº›æ—¶å€™ä¼šæŠŠæ•°æ®å­˜åœ¨ NSUserDefaults é‡Œï¼Œè€ŒStruct è½¬åŒ–æˆNSDataï¼ŒæŠ€æœ¯å¯è¡Œä½†å‘å¤š å‚è€ƒï¼š çŽ‹å·Swift Tips SwiftGG]]></content>
      <tags>
        <tag>Swift</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[My Heart Will Go On]]></title>
    <url>%2F2017%2F06%2F03%2FMy-Heart-Will-Go-On%2F</url>
    <content type="text"></content>
      <tags>
        <tag>æ…¢æ—¶å…‰</tag>
        <tag>ç”Ÿæ´»</tag>
        <tag>æ¢¦æƒ³</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hello World]]></title>
    <url>%2F2017%2F01%2F02%2Fhello-world%2F</url>
    <content type="text"><![CDATA[Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post1$ hexo new "My New Post" More info: Writing Run server1$ hexo server More info: Server Generate static files1$ hexo generate More info: Generating Deploy to remote sites1$ hexo deploy More info: Deployment]]></content>
  </entry>
</search>
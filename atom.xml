<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>å¨ç«‹å±±</title>
  <subtitle>è®°å½•å¿ƒè·¯å†ç¨‹</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2017-09-14T16:14:48.000Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>Willishine</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>pythonçˆ¬è™«</title>
    <link href="http://yoursite.com/2017/09/15/python%E7%88%AC%E8%99%AB/"/>
    <id>http://yoursite.com/2017/09/15/pythonçˆ¬è™«/</id>
    <published>2017-09-14T16:14:48.000Z</published>
    <updated>2017-09-14T16:14:48.000Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>RxSwiftå®è·µ</title>
    <link href="http://yoursite.com/2017/09/03/RxSwift%E5%AE%9E%E8%B7%B5/"/>
    <id>http://yoursite.com/2017/09/03/RxSwiftå®è·µ/</id>
    <published>2017-09-03T09:55:55.000Z</published>
    <updated>2017-09-03T09:55:55.000Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>NSURLProtocolé»‘é­”æ³•</title>
    <link href="http://yoursite.com/2017/06/29/NSURLProtocol%E9%BB%91%E9%AD%94%E6%B3%95/"/>
    <id>http://yoursite.com/2017/06/29/NSURLProtocolé»‘é­”æ³•/</id>
    <published>2017-06-29T15:33:54.000Z</published>
    <updated>2017-07-01T05:01:26.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å†™åœ¨å‰é¢çš„è¯"><a href="#å†™åœ¨å‰é¢çš„è¯" class="headerlink" title="å†™åœ¨å‰é¢çš„è¯"></a>å†™åœ¨å‰é¢çš„è¯</h1><blockquote>
<p>å®é™…åº”ç”¨ï¼šåœ¨å…¬å¸çš„æµ·å¤–é¡¹ç›®ä¸­ï¼Œåœ¨Appä¸­åµŒå…¥YouTubeç½‘é¡µï¼Œå½“è¿›å…¥ä¸€ä¸ªè§†é¢‘è¯¦æƒ…é¡µæ—¶ï¼Œè§†é¢‘ä¼šè‡ªåŠ¨æ’­æ”¾ã€‚è€Œéœ€æ±‚æ˜¯ä¸è¦è‡ªåŠ¨æ’­æ”¾ï¼Œè®©ç”¨æˆ·ç‚¹å‡»æˆ‘ä»¬è‡ªå®šä¹‰çš„æ’­æ”¾æŒ‰é’®æŠŠè§†é¢‘æŠ•åˆ°ç”µè§†ä¸Šæ’­æ”¾ã€‚ä¸‹é¢è®©æˆ‘ä»¬ä¸€èµ·å­¦ä¹ ä¸‹å¦‚ä½•æ‹¦æˆªç½‘ç»œè¯·æ±‚ã€‚</p>
</blockquote>
<h1 id="URL-Loading-System"><a href="#URL-Loading-System" class="headerlink" title="URL Loading System"></a>URL Loading System</h1><p><img src="https://ws1.sinaimg.cn/large/006tKfTcly1fh2yx18u8oj312q0o8q8a.jpg" alt="URL Loading System"><br>å¦‚å›¾æ‰€ç¤ºï¼ŒURL Loading Systemæ˜¯iOSä¸€ç³»åˆ—ç½‘ç»œè¯·æ±‚ç±»çš„é›†åˆï¼ŒåŒ…æ‹¬å·²ç»è¿‡æœŸä¸ç”¨çš„NSConnectionå’Œç°åœ¨æµè¡Œçš„NSURLSessionï¼Œè¿˜åŒ…æ‹¬ä¸€äº›è¯·æ±‚è®¤è¯çš„ç±»ï¼Œä¸€ä¸ªsessionConfigçš„ç±»ï¼Œè¿˜æœ‰å…³äºå¤„ç†è¯·æ±‚ç¼“å­˜çš„ç±»ç­‰ï¼Œå½“ç„¶è¿˜åŒ…æ‹¬æˆ‘ä»¬è¦è¯´çš„è¿™ä¸ªNSURLProtocolç±»ã€‚</p>
<h1 id="NSURLProtocol"><a href="#NSURLProtocol" class="headerlink" title="NSURLProtocol"></a>NSURLProtocol</h1><p>   NSURLProtocolå¯ä»¥è®©æˆ‘ä»¬æ‹¦æˆªç¨‹åºä¸­çš„ä¸€åˆ‡ç½‘ç»œè¯·æ±‚ï¼Œå› ä¸ºNSURLProtocolæ˜¯ä¸€ä¸ªè™šåŸºç±»ï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥ä½¿ç”¨å®ƒï¼Œè¦æƒ³ä½¿ç”¨å®ƒå°±å¿…é¡»è‡ªå®šä¹‰ä¸€ä¸ªç±»æˆä¸ºä»–çš„å­ç±»ï¼Œç„¶åå®ç°ä»–é‡Œé¢çš„å¿…é¡»å®ç°çš„ä¸€äº›æ–¹æ³•ã€‚ä¸»è¦è¿›è¡Œå¦‚ä¸‹æ‹¦æˆªå¤„ç†:</p>
<ul>
<li>è‡ªå®šä¹‰è¯·æ±‚ å’Œ å“åº”</li>
<li>è¿‡æ»¤æ‰æŸäº›è¯·æ±‚ä¸è®©å…¶å‘èµ·ã€ä»¥åŠä¿®æ”¹</li>
<li>æä¾› è‡ªå®šä¹‰çš„å…¨å±€ç¼“å­˜ é€»è¾‘</li>
<li>é‡å®šå‘ ç½‘ç»œè¯·æ±‚</li>
<li>æä¾› HTTP Mocking (æ–¹ä¾¿å‰æœŸæµ‹è¯•)</li>
</ul>
<h1 id="å¦‚ä½•æ‹¦æˆªç½‘ç»œè¯·æ±‚"><a href="#å¦‚ä½•æ‹¦æˆªç½‘ç»œè¯·æ±‚" class="headerlink" title="å¦‚ä½•æ‹¦æˆªç½‘ç»œè¯·æ±‚"></a>å¦‚ä½•æ‹¦æˆªç½‘ç»œè¯·æ±‚</h1><h2 id="æ³¨å†Œè‡ªå®šä¹‰çš„URLProtocolå­ç±»"><a href="#æ³¨å†Œè‡ªå®šä¹‰çš„URLProtocolå­ç±»" class="headerlink" title="æ³¨å†Œè‡ªå®šä¹‰çš„URLProtocolå­ç±»"></a>æ³¨å†Œè‡ªå®šä¹‰çš„URLProtocolå­ç±»</h2><ul>
<li>åœ¨appDelegateä¸­ï¼Œæ³¨å†Œè‡ªå·±æ‹¦æˆªè¯·æ±‚çš„URLProtocolå­ç±»;ç›¸å¯¹åº”çš„ä¹Ÿæœ‰unregistClassæ–¹æ³•ï¼Œä¸è®©æŸä¸ªå­ç±»èµ·ä½œç”¨</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">BOOL</span>)application:(<span class="built_in">UIApplication</span> *)application didFinishLaunchingWithOptions:(<span class="built_in">NSDictionary</span> *)launchOptions &#123;</div><div class="line">   </div><div class="line">   [<span class="built_in">NSURLProtocol</span> registerClass:[WSURLProtocol <span class="keyword">class</span>]];</div><div class="line">   </div><div class="line">   <span class="keyword">return</span> <span class="literal">YES</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="å­ç±»å¿…é¡»å®ç°çš„æ–¹æ³•"><a href="#å­ç±»å¿…é¡»å®ç°çš„æ–¹æ³•" class="headerlink" title="å­ç±»å¿…é¡»å®ç°çš„æ–¹æ³•"></a>å­ç±»å¿…é¡»å®ç°çš„æ–¹æ³•</h2><ul>
<li><code>+ (BOOL)canInitWithRequest:(NSURLRequest *)request</code><br>æ¯æ¬¡æœ‰ä¸€ä¸ªè¯·æ±‚çš„æ—¶å€™éƒ½ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•é‡Œé¢åˆ¤æ–­è¿™ä¸ªè¯·æ±‚æ˜¯å¦éœ€è¦è¢«å¤„ç†æ‹¦æˆªï¼Œå¦‚æœè¿”å›YESå°±ä»£è¡¨è¿™ä¸ªrequestéœ€è¦è¢«å¤„ç†ï¼Œåä¹‹å°±æ˜¯ä¸éœ€è¦è¢«å¤„ç†ã€‚</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">+ (<span class="built_in">BOOL</span>)canInitWithRequest:(<span class="built_in">NSURLRequest</span> *)request &#123;</div><div class="line">	<span class="comment">//åˆ¤æ–­æ˜¯å¦å¤„ç†è¿‡ï¼Œé˜²æ­¢æ­»å¾ªç¯</span></div><div class="line">    <span class="keyword">if</span> ([<span class="built_in">NSURLProtocol</span> propertyForKey:protocolKey inRequest:request]) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="literal">NO</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//åªæ‹¦æˆªhttpå’Œhttpsè¯·æ±‚</span></div><div class="line">    <span class="built_in">NSString</span> *scheme = [[request URL] scheme];</div><div class="line">    <span class="keyword">if</span> ([scheme caseInsensitiveCompare:<span class="string">@"http"</span>] == <span class="built_in">NSOrderedSame</span> ||</div><div class="line">        [scheme caseInsensitiveCompare:<span class="string">@"https"</span>] == <span class="built_in">NSOrderedSame</span>) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="literal">YES</span>;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> <span class="literal">NO</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li><code>+ (NSURLRequest *) canonicalRequestForRequest:(NSURLRequest *)request</code>  é€šå¸¸è¯¥æ–¹æ³•ä½ å¯ä»¥ç®€å•çš„ç›´æ¥è¿”å›requestï¼Œä½†ä¹Ÿå¯ä»¥åœ¨è¿™é‡Œä¿®æ”¹requestï¼Œæ¯”å¦‚æ·»åŠ headerï¼Œä¿®æ”¹hostç­‰ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„requestï¼Œè¿™æ˜¯ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œå­ç±»å¿…é¡»å®ç°ã€‚  </li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">+ (<span class="built_in">NSURLRequest</span> *)canonicalRequestForRequest:	(<span class="built_in">NSURLRequest</span> *)request &#123;</div><div class="line">    <span class="built_in">NSMutableURLRequest</span> *request = [request mutableCopy];</div><div class="line">    <span class="comment">//æŠŠè®¿é—®ç™¾åº¦çš„requestæ”¹ä¸ºè®¿é—®Googleäº†</span></div><div class="line">    request.URL = [<span class="built_in">NSURL</span> URLWithString:<span class="string">@"http://www.google.com"</span>];</div><div class="line">    <span class="keyword">return</span> request;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li><p><code>+ (BOOL)requestIsCacheEquivalent:(NSURLRequest *)a toRequest:(NSURLRequest *)b</code>  å¯ç”¨æ¥ä½¿ç”¨ç¼“å­˜æ•°æ®ç»“æŸæ­¤æ¬¡ç½‘ç»œè¯·æ±‚</p>
</li>
<li><p><code>- (void)startLoading</code>  å¼€å§‹è¯·æ±‚</p>
</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)startLoading &#123;</div><div class="line">	<span class="built_in">NSMutableURLRequest</span> *request = [<span class="keyword">self</span>.request mutableCopy];</div><div class="line">	<span class="comment">// æ ‡è®°requestå·²å¤„ç†    </span></div><div class="line">    [<span class="built_in">NSURLProtocol</span> setProperty:@(<span class="literal">YES</span>) forKey:protocolKey inRequest:request];</div><div class="line">    </div><div class="line">    <span class="comment">//ä½¿ç”¨NSURLSessionç»§ç»­æŠŠé‡å®šå‘çš„requestå‘é€å‡ºå»</span></div><div class="line">    <span class="built_in">NSURLSessionConfiguration</span> *config = [<span class="built_in">NSURLSessionConfiguration</span> ephemeralSessionConfiguration];</div><div class="line">    <span class="built_in">NSOperationQueue</span> *mainQueue = [<span class="built_in">NSOperationQueue</span> mainQueue];</div><div class="line">    </div><div class="line">    <span class="built_in">NSURLSession</span> *session = [<span class="built_in">NSURLSession</span> sessionWithConfiguration:config delegate:<span class="keyword">self</span> delegateQueue:mainQueue];</div><div class="line">    </div><div class="line">    <span class="built_in">NSURLSessionDataTask</span> *task = [session dataTaskWithRequest:request];</div><div class="line">    </div><div class="line">    [task resume];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li><p><code>-(void)stopLoading</code>  åœæ­¢è¯·æ±‚çš„æ–¹æ³•ï¼Œä¹Ÿæ˜¯è¦å®ç°çš„ã€‚</p>
<h1 id="NSURLProtocolClient"><a href="#NSURLProtocolClient" class="headerlink" title="NSURLProtocolClient"></a>NSURLProtocolClient</h1><p>å¦‚æœæˆ‘ä»¬ä½¿ç”¨UIWebViewå‘é€ä¸€ä¸ªrequestï¼Œæ‹¦æˆªä»¥åå½“æˆ‘ä»¬ä½¿ç”¨NSURLSessionå‘å‡ºäº†requestï¼Œé‚£ä¹ˆè¿™ä¸ªrequestçš„responseæ˜¯æ— æ³•å›åˆ°è¿™ä¸ªUIWebViewçš„ï¼Œå› ä¸ºå¯ä»¥ç†è§£æˆä¸æ˜¯åŒä¸€ä¸ªåœ°æ–¹å‘å‡ºçš„requestï¼Œè¿™ä¸ªresponseåªèƒ½æœ‰sessionæ¥å¤„ç†ï¼Œé‚£æˆ‘ä»¬æ€ä¹ˆæ‰èƒ½è®©è¿™ä¸ªresponseå›åˆ°åˆšå¼€å§‹çš„UIWebViewå‘¢ï¼Ÿ</p>
<p>NSURLProtocolClientå°±å¯ä»¥çœ‹åšæ˜¯URL Loading Systemï¼Œæˆ‘ä»¬æŠŠresponseå‘Šè¯‰clientï¼Œä¹Ÿå°±æ˜¯URL Loading Systemï¼Œè®©ä»–æ¥ç»§ç»­å¤„ç†è¿™ä¸ªresponseï¼Œå› ä¸ºä¸€åˆ‡éƒ½æ˜¯åŸºäºURL Loading Systemå‘ç”Ÿçš„ï¼Œæ‰€ä»¥æŠŠresponseäº¤ç»™ä»–ï¼Œä»–ä¼šè‡ªåŠ¨å¤„ç†è¿™ä¸ªresponseå›åˆ°webViewã€‚  </p>
<p>æ¯ä¸€ä¸ªNSURLProtocolçš„å­ç±»éƒ½æœ‰ä¸€ä¸ªclientå¯¹è±¡æ¥å¤„ç†è¯·æ±‚å¾—åˆ°çš„responseã€‚å…¶å®ä¸‹é¢è¿™äº›å†™æ³•éƒ½æ˜¯å·®ä¸å¤šå›ºå®šçš„ã€‚</p>
</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">-(<span class="keyword">void</span>)URLSession:(<span class="built_in">NSURLSession</span> *)session task:(<span class="built_in">NSURLSessionTask</span> *)task didCompleteWithError:(<span class="built_in">NSError</span> *)error &#123;</div><div class="line">    <span class="keyword">if</span> (error) &#123;</div><div class="line">        [<span class="keyword">self</span>.client URLProtocol:<span class="keyword">self</span> didFailWithError:error];</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        [<span class="keyword">self</span>.client URLProtocolDidFinishLoading:<span class="keyword">self</span>];</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">-(<span class="keyword">void</span>)URLSession:(<span class="built_in">NSURLSession</span> *)session dataTask:(<span class="built_in">NSURLSessionDataTask</span> *)dataTask didReceiveResponse:(<span class="built_in">NSURLResponse</span> *)response completionHandler:(<span class="keyword">void</span> (^)(<span class="built_in">NSURLSessionResponseDisposition</span>))completionHandler &#123;</div><div class="line">    [<span class="keyword">self</span>.client URLProtocol:<span class="keyword">self</span> didReceiveResponse:response cacheStoragePolicy:<span class="built_in">NSURLCacheStorageNotAllowed</span>];</div><div class="line">    </div><div class="line">    completionHandler(<span class="built_in">NSURLSessionResponseAllow</span>);</div><div class="line">&#125;</div><div class="line">-(<span class="keyword">void</span>)URLSession:(<span class="built_in">NSURLSession</span> *)session dataTask:(<span class="built_in">NSURLSessionDataTask</span> *)dataTask didReceiveData:(<span class="built_in">NSData</span> *)data &#123;</div><div class="line">    [<span class="keyword">self</span>.client URLProtocol:<span class="keyword">self</span> didLoadData:data];</div><div class="line">&#125;</div><div class="line">- (<span class="keyword">void</span>)URLSession:(<span class="built_in">NSURLSession</span> *)session dataTask:(<span class="built_in">NSURLSessionDataTask</span> *)dataTask willCacheResponse:(<span class="built_in">NSCachedURLResponse</span> *)proposedResponse completionHandler:(<span class="keyword">void</span> (^)(<span class="built_in">NSCachedURLResponse</span> *cachedResponse))completionHandler</div><div class="line">&#123;</div><div class="line">    completionHandler(proposedResponse);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><ul>
<li>é˜²æ­¢æ­»å¾ªç¯  <code>[NSURLProtocol setProperty:@(YES) forKey:protocolKey inRequest:request];</code></li>
<li>NSURLProtocol å¯ä»¥æ‹¦æˆª NSURLConnectionã€NSURLSessionã€UIwebview çš„è¯·æ±‚ï¼Œä½†æ˜¯ä¸èƒ½æ‹¦æˆªWKwebview å’ŒCFNetworkçš„è¯·æ±‚</li>
<li>AFNetworking 3.0 ä»¥åç‰ˆæœ¬æ‹¦æˆªä¸åˆ°è¯·æ±‚ï¼Œsessionçš„åˆ›å»ºæ–¹å¼ä¸åŒï¼Œé»˜è®¤ä¸èµ·ä½œç”¨ï¼Œ<a href="https://xz410236056.github.io/2016/09/01/NSURLProtocol%20%E6%8B%A6%E6%88%AA%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82/" target="_blank" rel="external">è§£å†³æ–¹æ³•</a></li>
</ul>
<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><p><a href="http://www.codertian.com/2016/10/23/black-magic-NSURLProtocol/" target="_blank" rel="external">ç”°è…¾é£çš„åšå®¢</a><br><a href="https://xz410236056.github.io/2016/09/01/NSURLProtocol%20%E6%8B%A6%E6%88%AA%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82/" target="_blank" rel="external">å¹»æƒ³ä¹¡</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;å†™åœ¨å‰é¢çš„è¯&quot;&gt;&lt;a href=&quot;#å†™åœ¨å‰é¢çš„è¯&quot; class=&quot;headerlink&quot; title=&quot;å†™åœ¨å‰é¢çš„è¯&quot;&gt;&lt;/a&gt;å†™åœ¨å‰é¢çš„è¯&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;å®é™…åº”ç”¨ï¼šåœ¨å…¬å¸çš„æµ·å¤–é¡¹ç›®ä¸­ï¼Œåœ¨Appä¸­åµŒå…¥YouTubeç½‘é¡µï¼Œå½“è¿›å…¥ä¸€ä¸ªè§†é¢‘è¯¦æƒ…
    
    </summary>
    
    
      <category term="NetWork" scheme="http://yoursite.com/tags/NetWork/"/>
    
      <category term="NSURLProtocol" scheme="http://yoursite.com/tags/NSURLProtocol/"/>
    
  </entry>
  
  <entry>
    <title>TVOSå¼€å‘æŠ€å·§</title>
    <link href="http://yoursite.com/2017/06/19/TVOS%E5%BC%80%E5%8F%91%E6%8A%80%E5%B7%A7/"/>
    <id>http://yoursite.com/2017/06/19/TVOSå¼€å‘æŠ€å·§/</id>
    <published>2017-06-19T04:43:11.000Z</published>
    <updated>2017-07-02T03:39:20.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å†™åœ¨å‰é¢çš„è¯"><a href="#å†™åœ¨å‰é¢çš„è¯" class="headerlink" title="å†™åœ¨å‰é¢çš„è¯"></a>å†™åœ¨å‰é¢çš„è¯</h1><blockquote>
<p>ä¹‹å‰ä¸€ç›´è§‰å¾—Apple TV æ˜¯ä¸ªç¥å¥‡çš„ä¸œè¥¿ï¼Œè¿·ä¸€æ ·çš„äº‹ç‰©ã€‚å›½å†…åŸºæœ¬è§ä¸åˆ°å®ƒçš„å½±å­ï¼Œè€Œå…¬å¸è¦åšä¸€ä¸ªApple TV appï¼Œä½œä¸ºä¸€åâ€èµ„æ·±â€iOSå¼€å‘è€…ï¼Œæ€ä¹ˆèƒ½ä¸å…´å¥‹å‘¢ğŸ˜<br>åœ¨ä½¿ç”¨Apple TVä¹‹åï¼Œæ„Ÿè§‰çœŸçš„æ¯”å›½å†…å®‰å“ç³»ç»Ÿçš„æ™ºèƒ½ç”µè§†è¦æƒŠè‰³å¾ˆå¤šï¼Œé¥æ§å™¨éƒ½é‚£ä¹ˆä¸ä¼—ä¸åŒï¼æ“ä½œæ–¹ä¾¿ï¼Œä¹Ÿèµå¿ƒæ‚¦ç›®ï¼›ç¼ºç‚¹æ˜¯ä¸èƒ½çœ‹å„ä¸ªç”µè§†é¢‘é“</p>
</blockquote>
<h1 id="å‰æœŸè°ƒç ”"><a href="#å‰æœŸè°ƒç ”" class="headerlink" title="å‰æœŸè°ƒç ”"></a>å‰æœŸè°ƒç ”</h1><ul>
<li>ç›¸å…³èµ„æ–™å¾ˆå°‘ï¼Œå›½å†…åŸºæœ¬æ²¡æœ‰å•¥èµ„æ–™ï¼Œåªèƒ½çœ‹è‹±æ–‡èµ„æ–™å•¦ï¼æ¨èä¸€æœ¬ä¹¦ç±ã€ŠtvOS Apprenticeã€‹å…¥é—¨</li>
<li>ä½¿ç”¨Swiftè¿›è¡Œå¼€å‘ï¼Œå›½å¤–èµ„æ–™åŸºæœ¬éƒ½ç”¨Swiftå†™ï¼Œèµ¶ç´§ä¸Šèˆ¹â€¦</li>
</ul>
<h1 id="è®²ç‚¹æœ‰è¶£çš„"><a href="#è®²ç‚¹æœ‰è¶£çš„" class="headerlink" title="è®²ç‚¹æœ‰è¶£çš„"></a>è®²ç‚¹æœ‰è¶£çš„</h1><h2 id="UIViewçš„focusç‰¹æ•ˆ"><a href="#UIViewçš„focusç‰¹æ•ˆ" class="headerlink" title="UIViewçš„focusç‰¹æ•ˆ"></a>UIViewçš„focusç‰¹æ•ˆ</h2><ul>
<li><p>åœ¨ç”µè§†å±å¹•ä¸Šä½ çœ‹åˆ°Appé‡Œå±•ç¤ºçš„ç•Œé¢ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯UIImageViewå‘ˆç°çš„ï¼Œå›¾ç‰‡æ¯”æ–‡å­—æ›´èƒ½å¸å¼•çœ¼çƒã€‚<br><img src="https://ws4.sinaimg.cn/large/006tKfTcly1fh4tlr07wcg30hs0b4hdv.gif" alt="ImageView Focus"><br>çœ‹åˆ°æ²¡æœ‰ï¼Œä½†ä½ ç”¨æ‰‹æŒ‡åœ¨é¥æ§å™¨è§¦æ‘¸åŒºæ‰“è½¬æ—¶ï¼Œè·å¾—ç„¦ç‚¹çš„å›¾ç‰‡ä¼šè¢«æ”¾å¤§ï¼Œéšæ‰‹æŒ‡æ—‹è½¬å¹¶å¸¦æœ‰çœ©å…‰çš„è§†è§‰ï¼è¿™æ ·çš„æ•ˆæœï¼Œåªéœ€è®¾ç½®UIImageViewçš„è‡ªå¸¦å±æ€§ï¼š<code>adjustsImageWhenAncestorFocused</code>å³å¯ï¼ŒçœŸæ£’ï¼ï¼ï¼</p>
</li>
<li><p>UIView æœ‰ä¸ªå±æ€§<code>canBecomeFocused</code>å¯ä»¥è®¾ç½®æ˜¯å¦èƒ½è·å¾—ç„¦ç‚¹çŠ¶æ€ï¼Œè®¾ç½®ä¸º<code>true</code>ï¼Œç„¶åé‡å†™<code>didUpdateFocus()</code>æ–¹æ³•</p>
</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">didUpdateFocus</span><span class="params">(<span class="keyword">in</span> context: UIFocusUpdateContext, with coordinator: UIFocusAnimationCoordinator)</span></span> &#123;</div><div class="line">        </div><div class="line">        <span class="keyword">if</span> context.nextFocusedView == <span class="keyword">self</span> &#123; <span class="comment">// è·å¾—ç„¦ç‚¹</span></div><div class="line">            <span class="keyword">self</span>.transform = <span class="type">CGAffineTransform</span>(scaleX: <span class="number">1.1</span>, y: <span class="number">1.1</span>)</div><div class="line">            <span class="keyword">self</span>.layer.shadowColor = <span class="type">UIColor</span>.black.alpha(<span class="number">0.36</span>).cgColor</div><div class="line">            <span class="keyword">self</span>.layer.shadowOffset = <span class="type">CGSize</span>(width: <span class="number">0</span>, height: <span class="number">30</span>)</div><div class="line">            <span class="comment">//è®¾ç½®é˜´å½±ï¼Œæ¨¡ç³Šæ•ˆæœçš„åŠå¾„</span></div><div class="line">            <span class="keyword">self</span>.layer.shadowRadius = <span class="number">50</span></div><div class="line">            <span class="keyword">self</span>.layer.shadowOpacity = <span class="number">1.0</span></div><div class="line">        &#125;<span class="keyword">else</span>&#123; <span class="comment">//å¤±å»ç„¦ç‚¹</span></div><div class="line">            <span class="keyword">self</span>.transform = <span class="type">CGAffineTransform</span>.identity</div><div class="line">            <span class="keyword">self</span>.layer.shadowOpacity = <span class="number">0.0</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>ä¸‹é¢å†çœ‹ä¸€ä¸ªæœ‰æ„æ€çš„<br><img src="https://ws3.sinaimg.cn/large/006tKfTcly1fh5b45kp08g30hs0b4x6p.gif" alt="è¡¨æƒ…"></p>
<p>UIImageViewçš„<code>animationImages</code>å¯ä»¥è®¾ç½®ä¸€ç»„å›¾ç‰‡ï¼Œç„¶åè®©å›¾ç‰‡åŠ¨èµ·æ¥~<br>å¯æ˜¯å½“ä½ æŠŠä¸€ç»„è¡¨æƒ…å›¾ç‰‡è®¾ç½®ç»™<code>animationImages</code>ï¼ŒImageViewè·å¾—ç„¦ç‚¹æ—¶ï¼Œè¡¨æƒ…å¹¶æ²¡æœ‰åŠ¨å•Šï¼  è§£å†³æ–¹æ³•ï¼šå°†UIImageViewåŠ åˆ°ä¸€ä¸ªUIViewä¸Šï¼Œå½“viewè·å¾—ç„¦ç‚¹æ—¶ï¼Œviewè°ƒæ•´<code>transform</code>çš„<code>scale</code>ï¼Œå¹¶è®©imageViewå¼€å§‹<code>startAnimating</code>ï¼›å¤±å»ç„¦ç‚¹æ—¶ï¼Œå°†viewçš„<code>transform</code>è¿˜åŸï¼ŒimageView<code>stopAnimating</code>ã€‚</p>
<h1 id="å¦‚ä½•æ§åˆ¶ç„¦ç‚¹"><a href="#å¦‚ä½•æ§åˆ¶ç„¦ç‚¹" class="headerlink" title="å¦‚ä½•æ§åˆ¶ç„¦ç‚¹"></a>å¦‚ä½•æ§åˆ¶ç„¦ç‚¹</h1><h2 id="Focus-Engineï¼ˆç„¦ç‚¹å¼•æ“ï¼‰"><a href="#Focus-Engineï¼ˆç„¦ç‚¹å¼•æ“ï¼‰" class="headerlink" title="Focus Engineï¼ˆç„¦ç‚¹å¼•æ“ï¼‰"></a>Focus Engineï¼ˆç„¦ç‚¹å¼•æ“ï¼‰</h2><ul>
<li>æˆ‘ä»¬å¯ä»¥å°†Focusè§†ä¸ºèšå…‰ç¯ï¼Œå°†ç”¨æˆ·çš„æ³¨æ„åŠ›å¼•å¯¼åˆ°å±å¹•ä¸Šçš„ç‰¹å®šå…ƒç´ ã€‚è§†å›¾å¯ä»¥çªå‡ºæ˜¾ç¤ºæˆ–èšç„¦ï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨é¥æ§å™¨å°†ç„¦ç‚¹ç§»åŠ¨åˆ°åº”ç”¨çš„ä¸åŒå…ƒç´ ã€‚</li>
<li>å½“ç”¨æˆ·åœ¨é¥æ§å™¨çš„è§¦æ‘¸é¢ä¸Šæ»‘åŠ¨æ—¶ï¼Œç„¦ç‚¹å¼•æ“å°†æœç€ç§»åŠ¨ç„¦ç‚¹çš„ä¸‹ä¸€ä¸ªè§†å›¾çš„æ–¹å‘ç§»åŠ¨ã€‚å¦‚æœå®ƒâ€œçœ‹åˆ°â€ä¸€ä¸ªï¼Œå®ƒå°†Focusæ”¾åœ¨é‚£é‡Œï¼Œå¦‚æœæ²¡æœ‰çœ‹åˆ°å®ƒï¼Œå®ƒä¸ä¼šç§»åŠ¨Focusã€‚</li>
</ul>
<p>ä¾‹å¦‚ï¼šä¸‹é¢ç®€å•çš„3ä¸ªæŒ‰é’®åº”ç”¨ç¨‹åºï¼Œå½“å³ä¸Šæ–¹çš„æŒ‰é’®å¤„äºç„¦ç‚¹çŠ¶æ€ï¼Œç”¨æˆ·å‘ä¸‹æ»‘åŠ¨ï¼Œæƒ³æ»‘åŠ¨åˆ°å·¦ä¸‹æ–¹æŒ‰é’®ï¼Œå› ä¸ºç„¦ç‚¹å¼•æ“çœ‹ä¸åˆ°ä»»ä½•è§†å›¾ï¼Œæ‰€ä»¥Focusä¸ä¼šç§»åŠ¨ã€‚<br><img src="https://ws1.sinaimg.cn/large/006tKfTcly1fh5bsya529j31c00r0174.jpg" alt="Focusç¤ºæ„å›¾"></p>
<p>è¿™æ—¶å€™è¯¥ <strong>UIFocusGuide</strong> ç™»åœºäº†  </p>
<h2 id="UIFocusGuide"><a href="#UIFocusGuide" class="headerlink" title="UIFocusGuide"></a>UIFocusGuide</h2><p><strong>UIFocusGuide</strong> ï¼šæ˜¯ä¸å¯è§çš„å¸ƒå±€æŒ‡å¯¼ï¼Œå¯å¸®åŠ©Focus EngineçŸ¥é“å°†Focusç§»åŠ¨åˆ°å“ªé‡Œã€‚<br>æˆ‘ä»¬æŠŠFocusGuideæ”¾åˆ°å³ä¸‹æ–¹ï¼Œæ•ˆæœå°±åƒä¸‹å›¾<br><img src="https://ws1.sinaimg.cn/large/006tKfTcly1fh5c8d3gdij31c00r0nay.jpg" alt="FocusGuide"></p>
<h3 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬æ·»åŠ ç„¦ç‚¹æŒ‡å—çš„è§†å›¾ã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Create the Focus Guide and add it to the view</span></div><div class="line"><span class="keyword">var</span> focusGuide = <span class="type">UIFocusGuide</span>()</div><div class="line">view.addLayoutGuide(focusGuide)</div><div class="line"></div><div class="line"><span class="comment">// Anchor the Focus Guide     </span></div><div class="line">focusGuide.widthAnchor.constraintEqualToAnchor(topRightButton.widthAnchor).active = <span class="literal">true</span></div><div class="line">focusGuide.heightAnchor.constraintEqualToAnchor(bottomLeftButton.heightAnchor).active = <span class="literal">true</span></div><div class="line">focusGuide.topAnchor.constraintEqualToAnchor(bottomLeftButton.topAnchor).active = <span class="literal">true</span></div><div class="line">focusGuide.leftAnchor.constraintEqualToAnchor(topRightButton.leftAnchor).active = <span class="literal">true</span></div></pre></td></tr></table></figure>
<p>ç„¶åï¼Œè¦ä½¿ç„¦ç‚¹æŒ‡å—ç›´æ¥èšç„¦åˆ°å·¦ä¸‹æ–¹çš„æŒ‰é’®ï¼Œæˆ‘ä»¬è®¾ç½®ç„¦ç‚¹æŒ‡å—çš„<code>preferredFocusView</code>å±æ€§; è¿™æ˜¯â€œç„¦ç‚¹æŒ‡å—â€å°†å¼•å¯¼ç„¦ç‚¹çš„viewã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Set preferred focus</span></div><div class="line"> focusGuide.preferredFocusedView = bottomLeftButton</div></pre></td></tr></table></figure>
<h3 id="è°ƒè¯•"><a href="#è°ƒè¯•" class="headerlink" title="è°ƒè¯•"></a>è°ƒè¯•</h3><p>å¦‚æœå®ƒä»¬æ²¡æœ‰èµ·ä½œç”¨ï¼Œå¦‚ä½•è°ƒè¯•â€ç„¦ç‚¹æŒ‡å—â€å‘¢ï¼Ÿ<br>è‹¹æœæä¾›ä¸¤ç§æ–¹å¼ï¼š</p>
<ol>
<li>Quick Look(å¿«é€ŸæŸ¥çœ‹)</li>
<li><code>_whyIsThisViewNotFocusable</code></li>
</ol>
<p><strong>å¿«é€ŸæŸ¥çœ‹</strong><br>Quick Lookæ˜¯ä¸€æ¬¾ç”¨äºè°ƒè¯•Focus Engineå’ŒFocus Guideé—®é¢˜çš„å¯è§†åŒ–å·¥å…·ã€‚<br>è¦ä½¿ç”¨å®ƒï¼Œä½ å¿…é¡»åœ¨æ–¹æ³•ä¸­å¾—åˆ°ä¸€ä¸ªä¸­æ–­didUpdateFocusInContext(context, withAnimationCoordinator coordinator); æ¯æ¬¡ç„¦ç‚¹è¢«ç§»åŠ¨æ—¶éƒ½ä¼šè¢«è°ƒç”¨ã€‚ç„¶åï¼Œåœ¨Xcodeå·¦ä¸‹è§’çš„Variblesè§†å›¾ä¸­ï¼Œçªå‡ºæ˜¾ç¤ºcontextå˜é‡ï¼Œç„¶åå•å‡»åº•éƒ¨çš„çœ¼ç›å›¾æ ‡ï¼ˆæˆ–æŒ‰ç©ºæ ¼é”®ï¼‰ã€‚</p>
<p><strong>whyIsThisViewNotFocusable</strong><br>è‹¹æœè¿˜æä¾›äº†ï¼ˆéå¸¸æè¿°æ€§åœ°å‘½åï¼‰LLDBå‘½ä»¤ï¼Œ_whyIsThisViewNotFocusableç§°ä¸ºå¦ä¸€ä¸ªFocusè°ƒè¯•å·¥å…·ã€‚</p>
<p>è¦ä½¿ç”¨æ­¤å‘½ä»¤ï¼Œæ‚¨éœ€è¦åœ¨ä»£ç ä¸­çš„ä»»ä½•ä½ç½®ï¼ˆæˆ–è€…ç”šè‡³æš‚åœå®ƒï¼‰ä¸­æ–­ä¸­æ–­ï¼Œå¹¶_whyIsThisViewNotFocusableåœ¨LLDBå‘½ä»¤è¡Œè°ƒè¯•å™¨ä¸­è¿è¡Œå‘½ä»¤ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[yourView _whyIsThisViewNotFocusable]</div></pre></td></tr></table></figure>
<p>Swiftå‘½ä»¤æ˜¯ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">po yourView.performSelector(<span class="type">Selector</span>(<span class="string">"_whyIsThisViewNotFocusable"</span>))</div></pre></td></tr></table></figure>
<p><strong>ç¬¬ä¸‰ä¸ªæ–¹æ³•Visual Focus Guides</strong><br><a href="https://github.com/davidengelhardt/VisualFocusGuides" target="_blank" rel="external">Githubåœ°å€</a></p>
<h1 id="å†åæ§½ä¸€ä¸‹"><a href="#å†åæ§½ä¸€ä¸‹" class="headerlink" title="å†åæ§½ä¸€ä¸‹"></a>å†åæ§½ä¸€ä¸‹</h1><p>ç»™å›¾ç‰‡åŠ åœ†è§’   </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">self</span>.bgImageV.layer.masksToBounds = <span class="literal">true</span></div><div class="line">   <span class="keyword">self</span>.bgImageV.layer.cornerRadius = <span class="number">10</span></div></pre></td></tr></table></figure>
<p>TVOSä¸Šå¯æ²¡è¿™ä¹ˆç®€å•ï¼Œè¿™ä¹ˆåšçš„åæœæ˜¯å½“å›¾ç‰‡åœ¨ç„¦ç‚¹çŠ¶æ€æ—¶ï¼Œå›¾ç‰‡æ”¾å¤§çš„éƒ¨åˆ†ä¼šè¢«è£å‰ªï¼Œè¿™å¤ªå‘äº†~ğŸ˜¢</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Kingfisheråº“çš„ç”Ÿæˆåœ†è§’æ–¹æ³•</span></div><div class="line"><span class="comment">///ä¸‹è½½ç½‘ç»œå›¾ç‰‡</span></div><div class="line"><span class="keyword">let</span> processor = <span class="type">RoundCornerImageProcessor</span>(cornerRadius: <span class="number">6</span>)</div><div class="line">   <span class="type">ImageView</span>.kf.setImage(with: model?.image, placeholder: <span class="literal">nil</span>, options: [.processor(processor)])</div><div class="line">   </div><div class="line">   <span class="comment">///æœ¬åœ°å›¾ç‰‡</span></div><div class="line">   <span class="keyword">let</span> image = <span class="type">UIImage</span>.createImage(color: <span class="type">UIColor</span>(<span class="string">"#908F8F"</span>), cornerRadius: <span class="number">0</span>, size: <span class="type">CGSize</span>(width: <span class="number">10</span>, height: <span class="number">10</span>))</div><div class="line">   <span class="comment">//fit ä¸€å®šè¦æ˜¯UIImageViewçš„sizeå¤§å°</span></div><div class="line">   <span class="type">ImageView</span>.image = image.kf.image(withRoundRadius: <span class="number">6</span>, fit: <span class="type">ImageView</span>.size)</div></pre></td></tr></table></figure>
<p>ä¸ºå•¥åœ¨TVAppä¸èƒ½ç»™UIImageViewè®¾ç½®åœ†è§’å‘¢ï¼Ÿè‹¹æœæ€ä¹ˆè€ƒè™‘çš„ï¼Ÿå¯èƒ½æ˜¯ä¸ªbugï¼</p>
<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><p><a href="http://blog.viacom.tech/2016/07/07/tvosfocusguides/" target="_blank" rel="external">Debugging Focus in tvOS</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;å†™åœ¨å‰é¢çš„è¯&quot;&gt;&lt;a href=&quot;#å†™åœ¨å‰é¢çš„è¯&quot; class=&quot;headerlink&quot; title=&quot;å†™åœ¨å‰é¢çš„è¯&quot;&gt;&lt;/a&gt;å†™åœ¨å‰é¢çš„è¯&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;ä¹‹å‰ä¸€ç›´è§‰å¾—Apple TV æ˜¯ä¸ªç¥å¥‡çš„ä¸œè¥¿ï¼Œè¿·ä¸€æ ·çš„äº‹ç‰©ã€‚å›½å†…åŸºæœ¬è§ä¸åˆ°å®ƒçš„å½±å­
    
    </summary>
    
    
      <category term="Swift" scheme="http://yoursite.com/tags/Swift/"/>
    
      <category term="TVOS" scheme="http://yoursite.com/tags/TVOS/"/>
    
  </entry>
  
  <entry>
    <title>iOSåº”ç”¨å†…è´­ä¹°IAP</title>
    <link href="http://yoursite.com/2017/06/13/iOS%E5%BA%94%E7%94%A8%E5%86%85%E8%B4%AD%E4%B9%B0IAP/"/>
    <id>http://yoursite.com/2017/06/13/iOSåº”ç”¨å†…è´­ä¹°IAP/</id>
    <published>2017-06-13T01:51:30.000Z</published>
    <updated>2017-07-01T04:56:06.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="iOSåº”ç”¨å†…è´­ä¹°IAP"><a href="#iOSåº”ç”¨å†…è´­ä¹°IAP" class="headerlink" title="iOSåº”ç”¨å†…è´­ä¹°IAP"></a>iOSåº”ç”¨å†…è´­ä¹°IAP</h1><blockquote>
<p>æœ€è¿‘è‹¹æœé’ˆå¯¹iOSåº”ç”¨è½¯ä»¶å¼€å‘è€…çš„æŒ‡å¼•æ”¿ç­–è¿›è¡Œäº†ä¿®æ”¹ï¼Œï¼Œç¬¬ä¸€æ¬¡æ˜ç¡®æŒ‡å‡ºç”¨æˆ·æ”¯ä»˜å°è´¹æˆ–è€…æ‰“èµï¼Œå¿…é¡»é€šè¿‡è‹¹æœçš„æ”¯ä»˜æ¸ é“ï¼Œä¹Ÿå°±æ˜¯ä¸èƒ½ç»•å¼€è‹¹æœiOSç®¡ç†æœºåˆ¶ã€‚å¾®ä¿¡åœ¨iOSç‰ˆæœ¬å–æ¶ˆäº†æ‰“èµåŠŸèƒ½ï¼ŒçŸ¥ä¹åˆ™æ˜¯å‘è‹¹æœä½äº†å¤´â€¦<br>è‹¹æœåœ¨ç›¸å…³æ–‡æ¡£ä¸­æåˆ°ï¼Œå¦‚æœå¼€å‘è€…æƒ³åœ¨iOSè½¯ä»¶æä¾›ä¸‹è¿°åŠŸèƒ½ï¼ˆæ¯”å¦‚ç”¨æˆ·è®¢é˜…ã€æ¸¸æˆå†…è™šæ‹Ÿè´§å¸ã€è·å–é«˜ç«¯ä¼šå‘˜å†…å®¹ã€æˆ–è€…æä¾›å®Œæ•´çš„åŠŸèƒ½ç‰ˆæœ¬ç­‰ï¼‰ï¼Œåˆ™å¼€å‘è€…å¿…é¡»ä½¿ç”¨è½¯ä»¶å†…è´­ä¹°ã€‚</p>
</blockquote>
<p><em>æœ¬æ–‡ä¸»è¦ä»¥è‡ªåŠ¨è®¢é˜…ç±»å‹äº§å“ä¸ºä¸»ï¼Œå…¶ä»–ç±»å‹äº§å“ä¸ºè¾…</em></p>
<h2 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h2><p><code>In-App Purchase</code>ï¼Œ ç®€ç§°IAPï¼Œå…è®¸åœ¨iOS appä¸macOS appä¸­å‡ºå”®å•†å“ã€‚</p>
<ul>
<li><strong>æ–°å»ºä¸€ä¸ªappï¼Œç„¶åæ·»åŠ App å†…è´­ä¹°é¡¹ç›®ï¼Œä¸»è¦åˆ†å››ç§å†…è´­ä¹°é¡¹ç›®ç±»å‹ã€‚</strong>  </li>
</ul>
<ol>
<li>æ¶ˆè€—å“ï¼ˆConsumable productsï¼‰ï¼šä¼šè¶Šç”¨è¶Šå°‘çš„ï¼Œæ¯”å¦‚æ¸¸æˆå†…é‡‘å¸ç­‰ã€‚</li>
<li>ä¸å¯æ¶ˆè€—å“ï¼ˆNon-consumable productsï¼‰ï¼šæ¯”å¦‚æ¸¸æˆä¸­è·‘è½¦ï¼Œç®€å•æ¥è¯´å°±æ˜¯ä¸€æ¬¡è´­ä¹°ï¼Œç»ˆèº«å¯ç”¨ï¼ˆç”¨æˆ·å¯éšæ—¶ä»App Store restoreï¼‰</li>
<li>è‡ªåŠ¨æ›´æ–°è®¢é˜…å“ï¼ˆAuto-renewable subscriptionsï¼‰ï¼šå’Œä¸å¯æ¶ˆè€—å“çš„ä¸åŒç‚¹æ˜¯æœ‰å¤±æ•ˆæ—¶é—´ã€‚æ¯”å¦‚ä¸€æ•´å¹´çš„ä»˜è´¹å‘¨åˆŠã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œå¼€å‘è€…å®šæœŸæŠ•é€’å†…å®¹ï¼Œç”¨æˆ·åœ¨è®¢é˜…æœŸå†…éšæ—¶å¯ä»¥è®¿é—®è¿™äº›å†…å®¹ã€‚è®¢é˜…å¿«è¦è¿‡æœŸæ—¶ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨æ›´æ–°è®¢é˜…ã€‚</li>
<li>éè‡ªåŠ¨æ›´æ–°è®¢é˜…å“ï¼ˆNon-renewable subscriptionsï¼‰ï¼šä¸€èˆ¬ä½¿ç”¨åœºæ™¯æ˜¯ä»ç”¨æˆ·ä»IAPè´­ä¹°åï¼Œè´­ä¹°ä¿¡æ¯å­˜æ”¾åœ¨è‡ªå·±çš„å¼€å‘è€…æœåŠ¡å™¨ä¸Šã€‚å¤±æ•ˆæ—¥æœŸ/å¯ç”¨æ˜¯ç”±å¼€å‘è€…æœåŠ¡å™¨è‡ªè¡Œæ§åˆ¶çš„ï¼Œè€Œéç”±App Storeæ§åˆ¶ï¼Œè¿™ä¸€ç‚¹ä¸è‡ªåŠ¨æ›´æ–°è®¢é˜…å“æœ‰å·®å¼‚ã€‚</li>
</ol>
<ul>
<li><p><strong>æ·»åŠ APPå†…è´­ä¹°é¡¹ç›®</strong><br><img src="https://ws1.sinaimg.cn/large/006tNbRwly1fgi5piu646j31kw0n6n2z.jpg" alt="å†…è´­é¡¹ç›®"></p>
</li>
<li><p><strong>è®¾ç½®ç¨åŠ¡å’Œé“¶è¡Œå¡ä¿¡æ¯</strong></p>
<p><img src="https://ws1.sinaimg.cn/large/006tNbRwly1fgi5x38ay6j30q505jwfb.jpg" alt="é“¶è¡Œå¡"></p>
</li>
<li><p><strong>æ·»åŠ æ²™ç›’æµ‹è¯•è´¦å·</strong><br><img src="https://ws3.sinaimg.cn/large/006tNbRwly1fgi63t9r71j30rb07u3z8.jpg" alt="æ²™ç›’æµ‹è¯•è´¦å·"></p>
</li>
</ul>
<h2 id="ä½¿ç”¨StoreKit-API"><a href="#ä½¿ç”¨StoreKit-API" class="headerlink" title="ä½¿ç”¨StoreKit API"></a>ä½¿ç”¨StoreKit API</h2><ol>
<li><p>è·å–äº§å“åˆ—è¡¨ï¼Œå±•ç°çš„äº§å“å¯ä»¥åå°é…ç½®(Consumableå¯æ¶ˆè€—å•†å“ä¸¾ä¾‹)</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// MARK: - FETCH AVAILABLE IAP PRODUCTS</span></div><div class="line">   <span class="function"><span class="keyword">func</span> <span class="title">fetchAvailableProducts</span><span class="params">()</span></span>  &#123;</div><div class="line">       <span class="type">Toast</span>(text: <span class="string">"fetching available products"</span>).show()</div><div class="line">       <span class="comment">// Put here your IAP Products ID's</span></div><div class="line">       <span class="keyword">let</span> productIdentifiers = <span class="type">NSSet</span>(objects:</div><div class="line">           <span class="type">COINS_PRODUCT_ID</span>,<span class="type">PREMIUM_PRODUCT_ID</span></div><div class="line">       )</div><div class="line">       </div><div class="line">       productsRequest = <span class="type">SKProductsRequest</span>(productIdentifiers: productIdentifiers <span class="keyword">as</span>! <span class="type">Set</span>&lt;<span class="type">String</span>&gt;)</div><div class="line">       productsRequest.delegate = <span class="keyword">self</span></div><div class="line">       productsRequest.start()</div><div class="line">   &#125;</div><div class="line">   </div><div class="line">   <span class="comment">// MARK: - REQUEST IAP PRODUCTS</span></div><div class="line">   <span class="function"><span class="keyword">func</span> <span class="title">productsRequest</span> <span class="params">(<span class="number">_</span> request:SKProductsRequest, didReceive response:SKProductsResponse)</span></span> &#123;</div><div class="line">       <span class="keyword">if</span> (response.products.<span class="built_in">count</span> &gt; <span class="number">0</span>) &#123;</div><div class="line">           <span class="type">Toast</span>(text: <span class="string">"fetch \(response.products.count) product success"</span>).show()</div><div class="line">           </div><div class="line">           iapProducts = response.products</div><div class="line">           </div><div class="line">           <span class="comment">// 1st IAP Product (Consumable) ------------------------------------</span></div><div class="line">           <span class="keyword">let</span> firstProduct = response.products[<span class="number">0</span>] <span class="keyword">as</span> <span class="type">SKProduct</span></div><div class="line">           </div><div class="line">           <span class="comment">// Get its price from iTunes Connect</span></div><div class="line">           <span class="keyword">let</span> numberFormatter = <span class="type">NumberFormatter</span>()</div><div class="line">           numberFormatter.formatterBehavior = .behavior10_4</div><div class="line">           numberFormatter.numberStyle = .currency</div><div class="line">           numberFormatter.locale = firstProduct.priceLocale</div><div class="line">           <span class="keyword">let</span> price1Str = numberFormatter.string(from: firstProduct.price)</div><div class="line">           </div><div class="line">           <span class="comment">// Show its description</span></div><div class="line">           consumableLabel.text = firstProduct.localizedDescription + <span class="string">"\nfor just \(price1Str!)"</span></div><div class="line">    	&#125;</div><div class="line">	&#125;</div></pre></td></tr></table></figure>
</li>
</ol>
<ol>
<li><p>è´­ä¹°äº§å“ï¼Œé¦–å…ˆæ£€æŸ¥è®¾å¤‡æ˜¯å¦æ”¯æŒå†…è´­ä¹°ï¼Œç„¶åå°†äº¤æ˜“åŠ å…¥æ”¯ä»˜é˜Ÿåˆ—</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// MARK: - MAKE PURCHASE OF A PRODUCT</span></div><div class="line">   <span class="function"><span class="keyword">func</span> <span class="title">canMakePurchases</span><span class="params">()</span></span> -&gt; <span class="type">Bool</span> &#123;  <span class="keyword">return</span> <span class="type">SKPaymentQueue</span>.canMakePayments()  &#125;</div><div class="line">   <span class="function"><span class="keyword">func</span> <span class="title">purchaseMyProduct</span><span class="params">(product: SKProduct)</span></span> &#123;</div><div class="line">       <span class="keyword">if</span> <span class="keyword">self</span>.canMakePurchases() &#123;</div><div class="line">           <span class="type">Toast</span>(text: <span class="string">"begin purchase for \(product.localizedTitle)"</span>).show()</div><div class="line">           </div><div class="line">           <span class="keyword">let</span> payment = <span class="type">SKPayment</span>(product: product)</div><div class="line">           <span class="type">SKPaymentQueue</span>.<span class="keyword">default</span>().add(<span class="keyword">self</span>)</div><div class="line">           <span class="type">SKPaymentQueue</span>.<span class="keyword">default</span>().add(payment)</div><div class="line">           </div><div class="line">           <span class="built_in">print</span>(<span class="string">"PRODUCT TO PURCHASE: \(product.productIdentifier)"</span>)</div><div class="line">           productID = product.productIdentifier</div><div class="line">           </div><div class="line">           </div><div class="line">           <span class="comment">// IAP Purchases dsabled on the Device</span></div><div class="line">       &#125; <span class="keyword">else</span> &#123;</div><div class="line">           <span class="type">UIAlertView</span>(title: <span class="string">"IAP Tutorial"</span>,</div><div class="line">                       message: <span class="string">"Purchases are disabled in your device!"</span>,</div><div class="line">                       delegate: <span class="literal">nil</span>, cancelButtonTitle: <span class="string">"OK"</span>).show()</div><div class="line">       &#125;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
</li>
<li><p>å¤„ç†æ”¯ä»˜ç»“æœ</p>
</li>
</ol>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// MARK:- IAP PAYMENT QUEUE</span></div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">paymentQueue</span><span class="params">(<span class="number">_</span> queue: SKPaymentQueue, updatedTransactions transactions: [SKPaymentTransaction])</span></span> &#123;</div><div class="line">        <span class="keyword">for</span> transaction:<span class="type">AnyObject</span> <span class="keyword">in</span> transactions &#123;</div><div class="line">            <span class="keyword">if</span> <span class="keyword">let</span> trans = transaction <span class="keyword">as</span>? <span class="type">SKPaymentTransaction</span> &#123;</div><div class="line">                <span class="keyword">let</span> msg = <span class="keyword">self</span>.descFromTransactionState(trans.transactionState);</div><div class="line">                <span class="keyword">if</span>(msg != <span class="literal">nil</span>)&#123;</div><div class="line">                    <span class="type">Toast</span>(text: msg).show()</div><div class="line">                &#125;</div><div class="line">                </div><div class="line">                <span class="keyword">switch</span> trans.transactionState &#123;</div><div class="line">                    </div><div class="line">                <span class="keyword">case</span> .purchased:</div><div class="line">                    <span class="type">SKPaymentQueue</span>.<span class="keyword">default</span>().finishTransaction(transaction <span class="keyword">as</span>! <span class="type">SKPaymentTransaction</span>)</div><div class="line">                    </div><div class="line">                    <span class="keyword">guard</span> <span class="keyword">let</span> receiptUrl = <span class="type">Bundle</span>.main.appStoreReceiptURL <span class="keyword">else</span> &#123;</div><div class="line">                        <span class="type">SKPaymentQueue</span>.<span class="keyword">default</span>()</div><div class="line">                        <span class="keyword">return</span></div><div class="line">                    &#125;</div><div class="line">                    </div><div class="line">                    <span class="keyword">let</span> receipt = <span class="keyword">try</span>? <span class="type">Data</span>.<span class="keyword">init</span>(contentsOf: receiptUrl)</div><div class="line">                                   </div><div class="line">                    <span class="comment">//è‡ªåŠ¨è®¢é˜…ç±»å‹éœ€è¦éªŒè¯receipt å‘åˆ° apple </span></div><div class="line">                    <span class="keyword">guard</span> <span class="keyword">let</span> receiptBase64String = receipt?.base64EncodedString() <span class="keyword">else</span> &#123;</div><div class="line">                        <span class="keyword">return</span></div><div class="line">                    &#125;</div><div class="line">                    <span class="keyword">let</span> dict = [<span class="string">"receipt-data"</span>: receiptBase64String]</div><div class="line">                    <span class="keyword">let</span> url:<span class="type">URL</span>? = <span class="type">URL</span>(string:<span class="string">"https://sandbox.itunes.apple.com/verifyReceipt"</span>)</div><div class="line">                    <span class="keyword">var</span> request = <span class="type">URLRequest</span>.<span class="keyword">init</span>(url: url!)</div><div class="line">                    request.httpMethod = <span class="string">"POST"</span></div><div class="line">                    <span class="keyword">let</span> data = <span class="keyword">try</span>? <span class="type">JSONSerialization</span>.data(withJSONObject: dict, options: <span class="type">JSONSerialization</span>.<span class="type">WritingOptions</span>.prettyPrinted)</div><div class="line">                    request.httpBody = data</div><div class="line"></div><div class="line">                    <span class="type">URLSession</span>.shared.dataTask(with: request, completionHandler: &#123; (data, response, error) <span class="keyword">in</span></div><div class="line">                        <span class="keyword">if</span>(data != <span class="literal">nil</span>)&#123;</div><div class="line">                            <span class="keyword">let</span> <span class="type">JSONObj</span> = <span class="keyword">try</span>? <span class="type">JSONSerialization</span>.jsonObject(with: data!, options: .allowFragments)</div><div class="line">                            <span class="keyword">let</span> str = <span class="type">String</span>(data: data!, encoding: .utf8)</div><div class="line">                            <span class="built_in">print</span>(str!)</div><div class="line">                            <span class="built_in">print</span>(<span class="type">JSONObj</span>!)</div><div class="line">                        &#125;</div><div class="line"></div><div class="line">                    &#125;).resume()</div><div class="line">                                                            </div><div class="line">                    <span class="keyword">break</span></div><div class="line">                    </div><div class="line">                <span class="keyword">case</span> .failed:</div><div class="line">                    <span class="type">SKPaymentQueue</span>.<span class="keyword">default</span>().finishTransaction(transaction <span class="keyword">as</span>! <span class="type">SKPaymentTransaction</span>)</div><div class="line">                    <span class="keyword">break</span></div><div class="line">                <span class="keyword">case</span> .restored:</div><div class="line">                    <span class="type">SKPaymentQueue</span>.<span class="keyword">default</span>().finishTransaction(transaction <span class="keyword">as</span>! <span class="type">SKPaymentTransaction</span>)</div><div class="line">                    <span class="keyword">break</span></div><div class="line">                    </div><div class="line">                <span class="keyword">default</span>: <span class="keyword">break</span></div><div class="line">                &#125;&#125;&#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h2 id="ä½¿ç”¨SwiftyStoreKitåº“ç®€åŒ–è°ƒç”¨API"><a href="#ä½¿ç”¨SwiftyStoreKitåº“ç®€åŒ–è°ƒç”¨API" class="headerlink" title="ä½¿ç”¨SwiftyStoreKitåº“ç®€åŒ–è°ƒç”¨API"></a>ä½¿ç”¨<a href="https://github.com/bizz84/SwiftyStoreKit" target="_blank" rel="external">SwiftyStoreKit</a>åº“ç®€åŒ–è°ƒç”¨API</h2><ul>
<li>SwiftyStoreKitå¯¹StoreKitçš„apiè¿›è¡Œå°è£…ï¼Œè°ƒç”¨èµ·æ¥æ›´åŠ æ–¹ä¾¿ã€‚å…·ä½“apiè¯·å‚è€ƒ<a href="https://github.com/bizz84/SwiftyStoreKit" target="_blank" rel="external">SwiftyStoreKit Github</a></li>
<li>éœ€è¦æ³¨æ„çš„è´­ä¹°å•†å“æ—¶api åŒºåˆ†åŸå­æ€§å’ŒéåŸå­æ€§ï¼›åŸå­æ€§æ˜¯è´­ä¹°æˆåŠŸåï¼Œè´­ä¹°çš„å†…å®¹èƒ½ç«‹å³ä¼ é€’ç»™ç”¨æˆ·ç•Œé¢ï¼Œè€ŒéåŸå­æ€§æ˜¯æŒ‡è´­ä¹°çš„å†…å®¹éœ€è¦ä»æœåŠ¡å™¨ä¸‹è½½ï¼Œéœ€è¦ä¸‹è½½å®Œæ¯•ï¼Œæ‰è°ƒç”¨å®Œæˆäº¤æ˜“çš„apiæ¥ç»“æŸäº¤æ˜“</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="type">SwiftyStoreKit</span>.purchaseProduct(<span class="string">"com.musevisions.SwiftyStoreKit.Purchase1"</span>, quantity: <span class="number">1</span>, atomically: <span class="literal">false</span>) &#123; result <span class="keyword">in</span></div><div class="line">    <span class="keyword">switch</span> result &#123;</div><div class="line">    <span class="keyword">case</span> .success(<span class="keyword">let</span> product):</div><div class="line">        <span class="comment">// fetch content from your server, then:</span></div><div class="line">        <span class="keyword">if</span> product.needsFinishTransaction &#123;</div><div class="line">            <span class="type">SwiftyStoreKit</span>.finishTransaction(product.transaction)</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">print</span>(<span class="string">"Purchase Success: \(product.productId)"</span>)</div><div class="line">    <span class="keyword">case</span> .error(<span class="keyword">let</span> error):</div><div class="line">        <span class="keyword">switch</span> error.code &#123;</div><div class="line">        <span class="keyword">case</span> .unknown: <span class="built_in">print</span>(<span class="string">"Unknown error. Please contact support"</span>)</div><div class="line">        <span class="keyword">case</span> .clientInvalid: <span class="built_in">print</span>(<span class="string">"Not allowed to make the payment"</span>)</div><div class="line">        <span class="keyword">case</span> .paymentCancelled: <span class="keyword">break</span></div><div class="line">        <span class="keyword">case</span> .paymentInvalid: <span class="built_in">print</span>(<span class="string">"The purchase identifier was invalid"</span>)</div><div class="line">        <span class="keyword">case</span> .paymentNotAllowed: <span class="built_in">print</span>(<span class="string">"The device is not allowed to make the payment"</span>)</div><div class="line">        <span class="keyword">case</span> .storeProductNotAvailable: <span class="built_in">print</span>(<span class="string">"The product is not available in the current storefront"</span>)</div><div class="line">        <span class="keyword">case</span> .cloudServicePermissionDenied: <span class="built_in">print</span>(<span class="string">"Access to cloud service information is not allowed"</span>)</div><div class="line">        <span class="keyword">case</span> .cloudServiceNetworkConnectionFailed: <span class="built_in">print</span>(<span class="string">"Could not connect to the network"</span>)</div><div class="line">        <span class="keyword">case</span> .cloudServiceRevoked: <span class="built_in">print</span>(<span class="string">"User has revoked permission to use this cloud service"</span>)</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="è‡ªåŠ¨è®¢é˜…ç±»å‹æ€»ç»“"><a href="#è‡ªåŠ¨è®¢é˜…ç±»å‹æ€»ç»“" class="headerlink" title="è‡ªåŠ¨è®¢é˜…ç±»å‹æ€»ç»“"></a>è‡ªåŠ¨è®¢é˜…ç±»å‹æ€»ç»“</h2><ol>
<li>æ³¨å†Œåœ¨AppDelegateä¸­<code>didFinishLaunchingWithOptions</code>ä¸­ï¼Œæ³¨å†Œäº¤æ˜“è§‚å¯Ÿè€…ï¼Œè¿™æ ·appå°±å¯ä»¥æ”¶åˆ°æ”¯ä»˜é˜Ÿåˆ—çš„é€šçŸ¥ï¼ˆè‡ªåŠ¨ç»­è®¢æ—¶ä¼šè¢«è°ƒç”¨ï¼‰</li>
<li>æ²™ç›’æµ‹è¯•å‘¨æœŸä¼šè¢«åŠ é€Ÿï¼Œè®¢é˜…å‘¨æœŸä¸º1å‘¨ï¼Œåœ¨æ²™ç›’ç¯å¢ƒä¸‹åªéœ€3åˆ†é’Ÿï¼Œ1ä¸ªæœˆåªéœ€5åˆ†é’Ÿâ€¦è‹¹æœè€ƒè™‘çš„æŒºå‘¨åˆ°çš„</li>
<li>ä¸€ä¸ªæ²™ç›’æµ‹è¯•è´¦å·ä¸€å¤©åªèƒ½è¢«æ›´æ–°è®¢é˜…<code>5</code>æ¬¡ï¼Œæµ‹è¯•è‡ªåŠ¨è®¢é˜…æ—¶å°¤å…¶æ³¨æ„ï¼Œå¯ä»¥ä½¿ç”¨å¤šä¸ªæµ‹è¯•è´¦å·ï¼ˆå½“æ—¶æˆ‘ä»¥ä¸ºæ²¡èƒ½è‡ªåŠ¨è®¢é˜…å‘¢ï¼‰</li>
<li>å®¢æˆ·ç«¯å…ˆå°†receiptå‘ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯å»éªŒè¯receipt æœ‰æ—¶è¿”å› <code>210007</code> çŠ¶æ€ç ï¼Œæ„å‘³ç€è¿™ä¸ªreceiptæ˜¯æµ‹è¯•ç¯å¢ƒçš„ï¼Œä½†å‘é€åˆ°äº†æ­£å¼ç¯å¢ƒ<a href="https://buy.itunes.apple.com/verifyReceip" target="_blank" rel="external">https://buy.itunes.apple.com/verifyReceip</a>ã€‚è€Œä¸”å®¡æ ¸æ—¶ï¼Œè‹¹æœäººå‘˜ä¹Ÿæ˜¯ç”¨æ²™ç›’ç¯å¢ƒæµ‹è¯•ï¼Œå¦‚ä½•åˆ‡æ¢æ­£å¼å’Œæµ‹è¯•ç¯å¢ƒå‘¢ï¼Ÿ<strong>è§£å†³æ–¹æ¡ˆï¼š</strong>æœåŠ¡ç«¯å…ˆèµ°æ­£å¼ç¯å¢ƒï¼Œå¦‚æœè¿”å›21007å°±å†èµ°æ²™ç›’ç¯å¢ƒå»éªŒè¯ã€‚</li>
<li>å…³äºç”¨æˆ·é€€æ¬¾ï¼Œéœ€è¦æœåŠ¡ç«¯å®šæœŸå»å‘App Storeå»æ ¡éªŒreceiptï¼Œåœ¨è¿”å›æ¥çš„æ•°æ®ä¸­æ£€æŸ¥æ˜¯å¦æœ‰ <code>cancellation_date</code> å­—æ®µï¼Œå¦‚æœæœ‰å€¼ï¼Œåˆ™è´­ä¹°ä¸æˆç«‹ã€‚</li>
</ol>
<hr>
<p><strong>æ¬¢è¿æŒ‡æ­£ğŸ˜</strong></p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://code.tutsplus.com/tutorials/in-app-purchase-tutorial-with-swift-3-ios-sdk--cms-27595" target="_blank" rel="external">In-App Purchases in iOS With Swift 3</a><br><a href="https://developer.apple.com/library/content/documentation/NetworkingInternet/Conceptual/StoreKitGuide/Introduction.html#//apple_ref/doc/uid/TP40008267-CH1-SW1" target="_blank" rel="external">è‹¹æœæ–‡æ¡£ About In-App Purchase</a><br><a href="https://developer.apple.com/library/content/releasenotes/General/ValidateAppStoreReceipt/Chapters/ReceiptFields.html#//apple_ref/doc/uid/TP40010573-CH106-SW1" target="_blank" rel="external">è‹¹æœæ–‡æ¡£ éªŒè¯Receipt</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;iOSåº”ç”¨å†…è´­ä¹°IAP&quot;&gt;&lt;a href=&quot;#iOSåº”ç”¨å†…è´­ä¹°IAP&quot; class=&quot;headerlink&quot; title=&quot;iOSåº”ç”¨å†…è´­ä¹°IAP&quot;&gt;&lt;/a&gt;iOSåº”ç”¨å†…è´­ä¹°IAP&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;æœ€è¿‘è‹¹æœé’ˆå¯¹iOSåº”ç”¨è½¯ä»¶å¼€å‘è€…çš„æŒ‡å¼•æ”¿ç­–
    
    </summary>
    
    
      <category term="Swift" scheme="http://yoursite.com/tags/Swift/"/>
    
      <category term="IAP" scheme="http://yoursite.com/tags/IAP/"/>
    
  </entry>
  
  <entry>
    <title>Value and Reference Type</title>
    <link href="http://yoursite.com/2017/06/03/Value-and-Reference-Type/"/>
    <id>http://yoursite.com/2017/06/03/Value-and-Reference-Type/</id>
    <published>2017-06-03T13:17:03.000Z</published>
    <updated>2017-06-04T06:10:35.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Swiftä¸­å€¼ç±»å‹å’Œå¼•ç”¨ç±»å‹"><a href="#Swiftä¸­å€¼ç±»å‹å’Œå¼•ç”¨ç±»å‹" class="headerlink" title="Swiftä¸­å€¼ç±»å‹å’Œå¼•ç”¨ç±»å‹"></a>Swiftä¸­å€¼ç±»å‹å’Œå¼•ç”¨ç±»å‹</h1><p><em>æœ¬æ–‡ä¸»è¦ä»‹ç»å€¼ç±»å‹ã€ä»¥åŠä½¿ç”¨Structä½œä¸ºæ•°æ®æ¨¡å‹çš„æ³¨æ„äº‹é¡¹</em></p>
<h2 id="å€¼ç±»å‹ï¼ˆvalue-typeï¼‰"><a href="#å€¼ç±»å‹ï¼ˆvalue-typeï¼‰" class="headerlink" title="å€¼ç±»å‹ï¼ˆvalue typeï¼‰"></a>å€¼ç±»å‹ï¼ˆvalue typeï¼‰</h2><p><strong>å€¼ç±»å‹ï¼š</strong>æ¯æ¬¡åˆ†é…ç»™å˜é‡/å¸¸é‡æˆ–è€…ä½œä¸ºå‚æ•°ä¼ é€’åˆ°å‡½æ•°æ—¶ï¼Œéƒ½ä¼šé‡æ–°åˆ›å»ºï¼ˆå¤åˆ¶ï¼‰ä¸€ä¸ªæ–°çš„å®ä¾‹ã€‚</p>
<p>Swift ä¸­çš„æ‰€æœ‰çš„å†…å»ºç±»å‹éƒ½æ˜¯å€¼ç±»å‹ï¼Œä¸ä»…åŒ…æ‹¬äº†ä¼ ç»Ÿæ„ä¹‰åƒ Intï¼ŒDoubleè¿™äº›ï¼Œç”šè‡³è¿ Stringï¼ŒArray ä»¥åŠ Dictionary éƒ½æ˜¯å€¼ç±»å‹çš„(ä¸OCä¸åŒ), swiftä¸­æ‰€æœ‰çš„Struct å’Œ enum éƒ½æ˜¯å€¼ç±»å‹ï¼Œå€¼ç±»å‹æ¯æ¬¡åˆå§‹åŒ–ä»¥åï¼Œå°†å®ƒåˆ†é…æˆ–è€…ä¼ é€’æ—¶ï¼Œå®é™…ä¸Šæ˜¯åˆ†é…æˆ–ä¼ é€’äº†å®ƒçš„ä¸€ä¸ªæ‹·è´ã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Point</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> x : <span class="type">Int</span></div><div class="line">    <span class="keyword">var</span> y : <span class="type">Int</span></div><div class="line">    <span class="keyword">init</span>(x:<span class="type">Int</span>, y:<span class="type">Int</span>) &#123;</div><div class="line">        <span class="keyword">self</span>.x = x</div><div class="line">        <span class="keyword">self</span>.y = y</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"> <span class="keyword">var</span> aPoint = <span class="type">Point</span>(x: <span class="number">10</span>, y: <span class="number">10</span>)</div><div class="line"> <span class="keyword">var</span> bPoint = aPoint</div><div class="line"> bPoint.x = <span class="number">5</span></div><div class="line"> <span class="built_in">print</span>(aPoint)</div><div class="line"> <span class="built_in">print</span>(bPoint)</div></pre></td></tr></table></figure>
<p><strong>æ‰“å°ç»“æœ</strong></p>
<p>Point(x: 10, y: 10)</p>
<p>Point(x: 5, y: 10)</p>
<p><strong>æ€»ç»“</strong>ï¼š</p>
<ol>
<li>èµ‹å€¼ç»™æ–°å˜é‡ï¼Œä¼šäº§ç”Ÿä¸€ä¸ªå•ç‹¬çš„ã€æ²¡æœ‰æ•°æ®å…±äº«çš„æ–°å®ä¾‹.</li>
<li>å€¼ç±»å‹åœ¨å¤åˆ¶æ—¶ï¼Œä¼šå°†å­˜å‚¨åœ¨å…¶ä¸­çš„å€¼ç±»å‹ä¸€å¹¶è¿›è¡Œå¤åˆ¶ï¼Œè€Œå¯¹äºå…¶ä¸­çš„å¼•ç”¨ç±»å‹çš„è¯ï¼Œåˆ™åªå¤åˆ¶ä¸€ä»½å¼•ç”¨ã€‚</li>
<li>å¤åˆ¶æ—¶æœºï¼Œæ˜¯åœ¨å€¼ç±»å‹ä¸­çš„å†…å®¹å‘ç”Ÿæ”¹å˜æ—¶ï¼å€¼ç±»å‹æ¯æ¬¡å¤åˆ¶ä¼šå¢åŠ é¢å¤–å¼€é”€ï¼ŒSwiftå°†è¿™ç§å¼€é”€æ§åˆ¶åœ¨æœ€å°çš„èŒƒå›´å†…ï¼Œåœ¨æ²¡æœ‰å¿…è¦å¤åˆ¶æ—¶ï¼Œå¤åˆ¶æ˜¯ä¸ä¼šå‘ç”Ÿçš„ã€‚~(â‰§â–½â‰¦)/~</li>
</ol>
<p><strong>çº¿ç¨‹å®‰å…¨ï¼š</strong><br>    åœ¨Swiftä¸­ï¼ŒArrayã€Stringã€Dictionaryéƒ½æ˜¯å€¼ç±»å‹ã€‚å®ƒä»¬çš„ä½¿ç”¨æ–¹å¼ç±»ä¼¼Cè¯­è¨€ä¸­å¾—intï¼Œæ¯ä¸€ä¸ªå®ä¾‹éƒ½æœ‰ä¸€ä»½æ•°æ®ã€‚ä½ ä¸éœ€è¦è¿›è¡Œæ˜¾ç¤ºçš„å¤åˆ¶æ“ä½œå»é˜²æ­¢æ•°æ®åœ¨ä½ ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹è¢«ä¿®æ”¹ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œä½ å¯ä»¥è·¨çº¿ç¨‹è¿›è¡Œä¼ å‚è€Œä¸éœ€è¦è€ƒè™‘åŒæ­¥çš„é—®é¢˜ï¼Œå› ä¸ºä¼ é€’å€¼ç±»å‹å¾ˆå®‰å…¨ã€‚ï¼ˆ<a href="https://developer.apple.com/swift/blog/?id=10" target="_blank" rel="external">Swiftå®˜æ–¹åšå®¢</a>ï¼‰</p>
<h2 id="å¼•ç”¨ç±»å‹ï¼ˆReference-Typesï¼‰"><a href="#å¼•ç”¨ç±»å‹ï¼ˆReference-Typesï¼‰" class="headerlink" title="å¼•ç”¨ç±»å‹ï¼ˆReference Typesï¼‰"></a>å¼•ç”¨ç±»å‹ï¼ˆReference Typesï¼‰</h2><p><strong>å¼•ç”¨ç±»å‹</strong>ï¼šå¼•ç”¨ç±»å‹åˆå§‹åŒ–åï¼Œæ— è®ºæ˜¯åˆ†é…ç»™å˜é‡è¿˜æ˜¯å¸¸é‡ï¼Œæˆ–æ˜¯é€šè¿‡å‚æ•°ä¼ é€’ç»™å‡½æ•°ï¼Œéƒ½å°†æ˜¯åŒä¸€ä¸ªå®ä¾‹å¯¹è±¡ã€‚<br>NSObjectå†ç†Ÿæ‚‰ä¸è¿‡äº†ï¼Œå½“åœ¨åˆ†é…æˆ–ä¼ é€’æ˜¯éƒ½æ˜¯å¼•ç”¨ï¼Œéƒ½æŒ‡å‘é‚£ä¸ªåŸå§‹å¯¹è±¡ã€‚ä¸å†å¤šè¯´äº†~</p>
<h2 id="Structæ•°æ®æ¨¡å‹"><a href="#Structæ•°æ®æ¨¡å‹" class="headerlink" title="Structæ•°æ®æ¨¡å‹"></a>Structæ•°æ®æ¨¡å‹</h2><p><strong>å¤„ç†æ•°æ®ç»“æ„æ—¶æœ‰æ—¶ä¼šç”¨Structè¿›è¡Œå¤„ç†ï¼Œä½¿ç”¨ Struct æ¥ä»£æ›¿ Class ä½œä¸ºæ•°æ®æ¨¡å‹æœ‰å¾ˆå¤šå¥½å¤„ã€‚å€¼ç±»å‹æ˜¯éå¸¸æœ‰ä¼˜åŠ¿çš„ï¼š</strong></p>
<ul>
<li>å®‰å…¨æ€§ ï¼šå› ä¸º Struct æ˜¯ç”¨å€¼ç±»å‹ä¼ é€’çš„ï¼Œå®ƒä»¬æ²¡æœ‰å¼•ç”¨è®¡æ•°ã€‚</li>
<li>å†…å­˜ï¼šç”±äºä»–ä»¬æ²¡æœ‰å¼•ç”¨æ•°ï¼Œä»–ä»¬ä¸ä¼šå› ä¸ºå¾ªç¯å¼•ç”¨å¯¼è‡´å†…å­˜æ³„æ¼ã€‚</li>
<li>é€Ÿåº¦ï¼šå€¼ç±»å‹é€šå¸¸æ¥è¯´æ˜¯ä»¥æ ˆçš„å½¢å¼åˆ†é…çš„ï¼Œè€Œä¸æ˜¯ç”¨å †ã€‚å› æ­¤ä»–ä»¬æ¯” Class è¦å¿«å¾ˆå¤šï¼ŒçœŸçš„å¾ˆå¤šï¼åœ¨ <a href="https://stackoverflow.com/questions/24232799/why-choose-struct-over-class/24232845" target="_blank" rel="external">StackOverflow</a> ç»™ Struct å’Œ Class è¿›è¡Œç›¸åŒæ“ä½œçš„è¡¨ç°åšäº†åŸºå‡†æµ‹è¯•ï¼ŒStruct æ¯” Class è¦å¿«ä¹ç™¾å€ã€‚</li>
<li>æ‹·è´ï¼šåœ¨ Objective-C é‡Œæ‹·è´ä¸€ä¸ªå¯¹è±¡,ä½ å¿…é¡»é€‰ç”¨æ­£ç¡®çš„æ‹·è´ç±»å‹ï¼ˆæ·±æ‹·è´ã€æµ…æ‹·è´ï¼‰ï¼Œè¿™æ˜¯éå¸¸çƒ¦äººçš„ï¼Œå€¼ç±»å‹çš„æ‹·è´åˆ™éå¸¸è½»æ¾ï¼</li>
<li>çº¿ç¨‹å®‰å…¨ï¼šå€¼ç±»å‹æ˜¯è‡ªåŠ¨çº¿ç¨‹å®‰å…¨çš„ã€‚æ— è®ºä½ ä»å“ªä¸ªçº¿ç¨‹å»è®¿é—®ä½ çš„ Struct ï¼Œéƒ½éå¸¸ç®€å•ã€‚</li>
</ul>
<p><strong>Structçš„ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li>OCæ— æ³•è°ƒç”¨Swiftçš„Structï¼Œå½“ä½ çš„é¡¹ç›®çš„ä»£ç æ˜¯ Swift å’Œ Objective-C æ··åˆå¼€å‘æ—¶ï¼Œä½ ä¼šå‘ç°åœ¨ Objective-C çš„ä»£ç é‡Œæ— æ³•è°ƒç”¨ Swift çš„ Structã€‚å› ä¸ºè¦åœ¨ Objective-C é‡Œè°ƒç”¨ Swift ä»£ç çš„è¯ï¼Œå¯¹è±¡éœ€è¦ç»§æ‰¿äº NSObjectã€‚</li>
<li>ä¸èƒ½ç»§æ‰¿ï¼Œç»§æ‰¿æ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹çš„å››å¤§ç‰¹æ€§ä¹‹ä¸€ï¼Œæ²¡æœ‰ç»§æ‰¿å°±ä¸èƒ½æŠ½è±¡ä¸€ä¸ªç»Ÿä¸€æ¨¡å‹</li>
<li>Struct ä¸èƒ½è¢«åºåˆ—åŒ–æˆ NSData å¯¹è±¡ã€‚æŸäº›æ—¶å€™ä¼šæŠŠæ•°æ®å­˜åœ¨ NSUserDefaults é‡Œï¼Œè€ŒStruct è½¬åŒ–æˆNSDataï¼ŒæŠ€æœ¯å¯è¡Œä½†å‘å¤š</li>
</ul>
<p>å‚è€ƒï¼š</p>
<p><a href="http://swifter.tips/value-reference/" target="_blank" rel="external">ç‹å·Swift Tips</a></p>
<p><a href="http://swift.gg/2016/07/22/swift-caveats-for-structs-as-data-models/" target="_blank" rel="external">SwiftGG</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Swiftä¸­å€¼ç±»å‹å’Œå¼•ç”¨ç±»å‹&quot;&gt;&lt;a href=&quot;#Swiftä¸­å€¼ç±»å‹å’Œå¼•ç”¨ç±»å‹&quot; class=&quot;headerlink&quot; title=&quot;Swiftä¸­å€¼ç±»å‹å’Œå¼•ç”¨ç±»å‹&quot;&gt;&lt;/a&gt;Swiftä¸­å€¼ç±»å‹å’Œå¼•ç”¨ç±»å‹&lt;/h1&gt;&lt;p&gt;&lt;em&gt;æœ¬æ–‡ä¸»è¦ä»‹ç»å€¼ç±»å‹ã€ä»¥åŠä½¿ç”¨Stru
    
    </summary>
    
    
      <category term="Swift" scheme="http://yoursite.com/tags/Swift/"/>
    
  </entry>
  
  <entry>
    <title>My Heart Will Go On</title>
    <link href="http://yoursite.com/2017/06/03/Willishine%E7%9A%84%E4%B8%96%E7%95%8C/"/>
    <id>http://yoursite.com/2017/06/03/Willishineçš„ä¸–ç•Œ/</id>
    <published>2017-06-03T13:15:20.000Z</published>
    <updated>2017-07-05T00:50:07.000Z</updated>
    
    <content type="html"><![CDATA[<ul>
<li><p>å¦‚æœæƒ³è¦æˆåŠŸï¼Œé‚£å°±è¦åŠªåŠ›ï¼›å…‰åŠªåŠ›è¿˜ä¸å¤Ÿï¼Œè¿˜è¦åšæŒï¼Œå¦‚æœåšæŒä¸äº†ï¼Œé‚£å°±ä¸è¦æŠ±æ€¨â€¦  </p>
</li>
<li><p>è‡ªå·±æœ‰å¤šæƒ³æˆåŠŸï¼Ÿå½“ä½ æƒ³æˆåŠŸçš„æ¬²æœ›å¼ºçƒˆçš„åƒæƒ³è¦å‘¼å¸ä¸€æ ·ï¼ŒæˆåŠŸæ‰æ›´æœ‰å¯èƒ½â€¦</p>
</li>
<li><p>â€œäººç”Ÿæ²¡æœ‰å½©æ’ï¼Œæ¯ä¸€å¤©éƒ½æ˜¯ç°åœºç›´æ’­â€ã€‚å¶å°”ä¼šæƒ³ï¼Œå¦‚æœäººç”ŸçœŸå¦‚ä¸€åœºç”µå­æ¸¸æˆï¼Œç©åäº†å¯ä»¥é€‰æ‹©é‡æ¥ï¼Œç”Ÿæ´»ä¼šå˜æˆä»€ä¹ˆæ ·å­ï¼Ÿæ­£å› ä¸ºæ—¶å…‰æµé€ä¸€å»ä¸å¤è¿”ï¼Œæ¯ä¸€å¤©éƒ½ä¸å¯è¿½å›ï¼Œæ‰€ä»¥æ›´è¦çæƒœæ¯ä¸€å¯¸å…‰é˜´ï¼Œå­æ•¬çˆ¶æ¯ã€ç–¼çˆ±å­©å­ã€ä½“è´´çˆ±äººã€å–„å¾…æœ‹å‹ï¼</p>
</li>
<li><p>æˆ‘æƒ³è¦çº¯ç²¹çš„ç”Ÿæ´»<br>æƒ³è¦å¥‹æ–—çš„å–œæ‚¦<br>æƒ³è¦å¥åº·çš„ä½“é­„<br>æƒ³è¦ä¸€ä¸ªæœ‰è¶£çš„çµé­‚<br>äºŒåå…­çš„æˆ‘ï¼Œä»ç„¶æ¸´æœ›å‡ºå‘â€¦</p>
</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;ul&gt;
&lt;li&gt;&lt;p&gt;å¦‚æœæƒ³è¦æˆåŠŸï¼Œé‚£å°±è¦åŠªåŠ›ï¼›å…‰åŠªåŠ›è¿˜ä¸å¤Ÿï¼Œè¿˜è¦åšæŒï¼Œå¦‚æœåšæŒä¸äº†ï¼Œé‚£å°±ä¸è¦æŠ±æ€¨â€¦  &lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;è‡ªå·±æœ‰å¤šæƒ³æˆåŠŸï¼Ÿå½“ä½ æƒ³æˆåŠŸçš„æ¬²æœ›å¼ºçƒˆçš„åƒæƒ³è¦å‘¼å¸ä¸€æ ·ï¼ŒæˆåŠŸæ‰æ›´æœ‰å¯èƒ½â€¦&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;â€œäººç”Ÿæ²¡æœ‰å½©æ’ï¼Œæ¯ä¸€å¤©éƒ½æ˜¯ç°åœºç›´
    
    </summary>
    
    
      <category term="æ…¢æ—¶å…‰" scheme="http://yoursite.com/tags/%E6%85%A2%E6%97%B6%E5%85%89/"/>
    
      <category term="ç”Ÿæ´»" scheme="http://yoursite.com/tags/%E7%94%9F%E6%B4%BB/"/>
    
      <category term="æ¢¦æƒ³" scheme="http://yoursite.com/tags/%E6%A2%A6%E6%83%B3/"/>
    
  </entry>
  
  <entry>
    <title>OCå’ŒJavaScriptäº¤äº’</title>
    <link href="http://yoursite.com/2017/05/23/OC%E5%92%8CJavaScript%E4%BA%A4%E4%BA%92/"/>
    <id>http://yoursite.com/2017/05/23/OCå’ŒJavaScriptäº¤äº’/</id>
    <published>2017-05-23T15:37:05.000Z</published>
    <updated>2017-07-03T16:50:56.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="UIWebViewä¸JavaScriptäº¤äº’"><a href="#UIWebViewä¸JavaScriptäº¤äº’" class="headerlink" title="UIWebViewä¸JavaScriptäº¤äº’"></a>UIWebViewä¸JavaScriptäº¤äº’</h1><h2 id="åŸºæœ¬çš„æ¦‚å¿µ"><a href="#åŸºæœ¬çš„æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬çš„æ¦‚å¿µ"></a>åŸºæœ¬çš„æ¦‚å¿µ</h2><ul>
<li><code>JavaScriptCore</code>æ˜¯å°è£…äº†JavaScriptå’ŒObjective-Cæ¡¥æ¥çš„Objective-C APIï¼Œåªè¦ç”¨å¾ˆå°‘çš„ä»£ç ï¼Œå°±å¯ä»¥åšåˆ°JavaScriptè°ƒç”¨Objective-Cï¼Œæˆ–è€…Objective-Cè°ƒç”¨JavaScriptã€‚</li>
<li><code>JSValue</code>: ä»£è¡¨ä¸€ä¸ªJavaScriptå®ä½“ï¼Œä¸€ä¸ªJSValueå¯ä»¥è¡¨ç¤ºå¾ˆå¤šJavaScriptåŸå§‹ç±»å‹ä¾‹å¦‚boolean, integers, doublesï¼Œç”šè‡³åŒ…æ‹¬å¯¹è±¡å’Œå‡½æ•°ã€‚</li>
<li><code>JSContext</code>: ä»£è¡¨JavaScriptçš„è¿è¡Œç¯å¢ƒï¼Œä½ éœ€è¦ç”¨JSContextæ¥æ‰§è¡ŒJavaScriptä»£ç ã€‚æ‰€æœ‰çš„JSValueéƒ½æ˜¯æ†ç»‘åœ¨ä¸€ä¸ªJSContextä¸Šçš„.</li>
<li><code>JSExport</code>: è¿™æ˜¯ä¸€ä¸ªåè®®ï¼Œå¯ä»¥ç”¨è¿™ä¸ªåè®®æ¥å°†åŸç”Ÿå¯¹è±¡å¯¼å‡ºç»™JavaScriptï¼Œè¿™æ ·åŸç”Ÿå¯¹è±¡çš„å±æ€§æˆ–æ–¹æ³•å°±æˆä¸ºäº†JavaScriptçš„å±æ€§æˆ–æ–¹æ³•ï¼Œéå¸¸ç¥å¥‡ã€‚</li>
</ul>
<h2 id="OCè°ƒç”¨JSçš„æ–¹æ³•"><a href="#OCè°ƒç”¨JSçš„æ–¹æ³•" class="headerlink" title="OCè°ƒç”¨JSçš„æ–¹æ³•"></a>OCè°ƒç”¨JSçš„æ–¹æ³•</h2><p>é‡‡ç”¨stringByEvaluatingJavaScriptFromStringå†™å…¥JSä»£ç ï¼Œè°ƒç”¨JSçš„æ–¹æ³•<br>é‡‡ç”¨ç³»ç»Ÿæ¡†æ¶<javascriptcore javascriptcore.h="">çš„JSContext +evaluateScriptè°ƒç”¨JSä»£ç </javascriptcore></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 1.UIWebViewæ‰§è¡ŒJSä»£ç </span></div><div class="line">[<span class="keyword">self</span>.webView stringByEvaluatingJavaScriptFromString:<span class="string">@"showName('Willi')"</span>];</div><div class="line"><span class="comment">// 2.JavaScriptCoreæ‰§è¡ŒJS</span></div><div class="line">JSContext *context = [[JSContext alloc] init];</div><div class="line"><span class="built_in">NSString</span> *jsCode = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"alert(\"æˆ‘æ˜¯OCé‡Œé¢çš„jsæ–¹æ³•\")"</span>];</div><div class="line">[context evaluateScript:jsCode];</div></pre></td></tr></table></figure>
<h2 id="JSè°ƒç”¨OCçš„æ–¹æ³•"><a href="#JSè°ƒç”¨OCçš„æ–¹æ³•" class="headerlink" title="JSè°ƒç”¨OCçš„æ–¹æ³•"></a>JSè°ƒç”¨OCçš„æ–¹æ³•</h2><ol>
<li>é‡‡ç”¨ä¼ ç»Ÿçš„æ–¹æ³•ï¼ŒåŠ è½½WebViewçš„æ—¶å€™æˆªå–URLçš„æ–¹å¼</li>
<li>åˆ©ç”¨è‹¹æœç³»ç»Ÿæ¡†æ¶<javascriptcore javascriptcore.h="">çš„JSContextçš„blockæ–¹å¼ æˆ–è€… JSExportåè®®æ–¹å¼</javascriptcore></li>
</ol>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//æ³¨å†ŒprintAandBæ–¹æ³•</span></div><div class="line"> context[<span class="string">@"printAandB"</span>] = ^(<span class="built_in">NSString</span> *A ,<span class="built_in">NSString</span> *B) &#123;</div><div class="line">     <span class="built_in">NSLog</span>(<span class="string">@"%@,%@"</span>,A,B);</div><div class="line"> &#125;;</div><div class="line"> </div><div class="line"><span class="comment">//è‡ªå®šä¹‰åè®®ï¼Œå¹¶ä¸”åè®®éµå®ˆ&lt;JSExport&gt;åè®®</span></div><div class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">WuKongJSExport</span> &lt;<span class="title">JSExport</span>&gt;</span></div><div class="line">JSExportAs(Invoke, - (<span class="keyword">void</span>)invokeKey:(<span class="built_in">NSString</span> *)key value:(<span class="built_in">NSString</span> *)value);</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<h1 id="WKWebViewä¸JavaScriptçš„äº¤äº’"><a href="#WKWebViewä¸JavaScriptçš„äº¤äº’" class="headerlink" title="WKWebViewä¸JavaScriptçš„äº¤äº’"></a>WKWebViewä¸JavaScriptçš„äº¤äº’</h1><h2 id="WKWebView"><a href="#WKWebView" class="headerlink" title="WKWebView"></a>WKWebView</h2><p><strong>WKWebView</strong>æ˜¯è‹¹æœåœ¨iOS 8ä¸­å¼•å…¥çš„æ–°ç»„ä»¶ï¼Œç›®çš„æ˜¯ç»™å‡ºä¸€ä¸ªæ–°çš„é«˜æ€§èƒ½çš„WebViewè§£å†³æ–¹æ¡ˆï¼Œæ‘†è„±è¿‡å» UIWebViewçš„è€ã€æ—§ã€ç¬¨é‡ï¼Œç‰¹åˆ«æ˜¯å†…å­˜å ç”¨é‡å·¨å¤§çš„é—®é¢˜ã€‚</p>
<h2 id="OCè°ƒç”¨JSçš„æ–¹æ³•-1"><a href="#OCè°ƒç”¨JSçš„æ–¹æ³•-1" class="headerlink" title="OCè°ƒç”¨JSçš„æ–¹æ³•"></a>OCè°ƒç”¨JSçš„æ–¹æ³•</h2><ul>
<li>åŸç”Ÿè°ƒç”¨JavaScriptçš„ä»£ç éœ€è¦åœ¨é¡µé¢åŠ è½½å®Œæˆä¹‹åï¼Œå°±æ˜¯åœ¨ - webView:didFinishNavigation:ä»£ç†æ–¹æ³•é‡Œé¢</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[webView evaluateJavaScript:<span class="string">@"showAlert('å¥æ˜¯ä¸€ä¸ªå¼¹æ¡†')"</span> completionHandler:^(<span class="keyword">id</span> item, <span class="built_in">NSError</span> * _Nullable error) &#123;</div><div class="line">        <span class="comment">// Blockä¸­å¤„ç†æ˜¯å¦é€šè¿‡äº†æˆ–è€…æ‰§è¡ŒJSé”™è¯¯çš„ä»£ç </span></div><div class="line"> &#125;];</div></pre></td></tr></table></figure>
<h2 id="JSè°ƒç”¨OCçš„æ–¹æ³•-1"><a href="#JSè°ƒç”¨OCçš„æ–¹æ³•-1" class="headerlink" title="JSè°ƒç”¨OCçš„æ–¹æ³•"></a>JSè°ƒç”¨OCçš„æ–¹æ³•</h2><ul>
<li><p>JavaScriptçš„é…ç½®<br>JavaScriptè°ƒç”¨Nativeçš„æ–¹æ³•å°±éœ€è¦å‰ç«¯å’ŒNativeçš„å°ä¼™ä¼´ä»¬é…åˆäº†ï¼Œéœ€è¦å‰ç«¯çš„å°ä¼™ä¼´åœ¨JSçš„æ–¹æ³•ä¸­è°ƒç”¨ï¼š<br><code>window.webkit.messageHandlers.NativeMethod.postMessage(&quot;å°±æ˜¯ä¸€ä¸ªæ¶ˆæ¯å•Š&quot;);</code></p>
</li>
<li><p>Native Appçš„ä»£ç é…ç½®</p>
</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">// åˆ›å»ºé…ç½®</span></div><div class="line"> <span class="built_in">WKWebViewConfiguration</span> *config = [[<span class="built_in">WKWebViewConfiguration</span> alloc] init];</div><div class="line"> <span class="comment">// åˆ›å»ºUserContentControllerï¼ˆæä¾›JavaScriptå‘webViewå‘é€æ¶ˆæ¯çš„æ–¹æ³•ï¼‰</span></div><div class="line"> <span class="built_in">WKUserContentController</span>* userContent = [[<span class="built_in">WKUserContentController</span> alloc] init];</div><div class="line"> <span class="comment">// æ·»åŠ æ¶ˆæ¯å¤„ç†ï¼Œæ³¨æ„ï¼šselfæŒ‡ä»£çš„å¯¹è±¡éœ€è¦éµå®ˆWKScriptMessageHandleråè®®ï¼Œç»“æŸæ—¶éœ€è¦ç§»é™¤</span></div><div class="line">[userContent addScriptMessageHandler:<span class="keyword">self</span> name:<span class="string">@"NativeMethod"</span>];</div><div class="line"> <span class="comment">// å°†UserConttentControllerè®¾ç½®åˆ°é…ç½®æ–‡ä»¶</span></div><div class="line"> config.userContentController = userContent;</div><div class="line"> <span class="comment">// é«˜ç«¯çš„è‡ªå®šä¹‰é…ç½®åˆ›å»ºWKWebView</span></div><div class="line"> <span class="built_in">WKWebView</span> *webView = [[<span class="built_in">WKWebView</span> alloc] initWithFrame:[<span class="built_in">UIScreen</span> mainScreen].bounds configuration:config];</div><div class="line"> <span class="comment">// è®¾ç½®è®¿é—®çš„URL</span></div><div class="line"> <span class="built_in">NSURL</span> *url = [<span class="built_in">NSURL</span> URLWithString:<span class="string">@"http://www.jianshu.com"</span>];</div><div class="line"> <span class="comment">// æ ¹æ®URLåˆ›å»ºè¯·æ±‚</span></div><div class="line"> <span class="built_in">NSURLRequest</span> *request = [<span class="built_in">NSURLRequest</span> requestWithURL:url];</div><div class="line"> <span class="comment">// WKWebViewåŠ è½½è¯·æ±‚</span></div><div class="line"> [webView loadRequest:request];</div><div class="line"> <span class="comment">// å°†WKWebViewæ·»åŠ åˆ°è§†å›¾</span></div><div class="line"> [<span class="keyword">self</span>.view addSubview:webView];</div></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œæ·»åŠ æ¶ˆæ¯å¤„ç†çš„handlerçš„nameï¼Œå°±æ˜¯JavaScriptä¸­è°ƒç”¨æ—¶å€™çš„<code>NativeMethod</code>ï¼Œè¿™ä¸¤ä¸ªè¦ä¿æŒä¸€è‡´ã€‚è¯·æŠŠURLæ¢æˆä½ è‡ªå·±çš„ã€‚<br>é…ç½®å½“å‰ViewControllerä¸ºMessageHandlerï¼Œéœ€è¦æœä»<code>WKScriptMessageHandler</code>åè®®ï¼Œå¦‚æœå‡ºç°è­¦å‘Šâš ï¸ï¼Œè¯·æ£€æŸ¥æ˜¯å¦æœä»äº†è¿™ä¸ªåè®®ã€‚<br><strong>æ³¨æ„ï¼æ³¨æ„ï¼æ³¨æ„ï¼š</strong>ä¸Šé¢å°†å½“å‰ViewControllerè®¾ç½®ä¸ºMessageHandlerä¹‹åéœ€è¦åœ¨å½“å‰ViewControlleré”€æ¯å‰å°†å…¶ç§»é™¤ï¼Œå¦åˆ™ä¼šé€ æˆå†…å­˜æ³„æ¼ã€‚</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[webView.configuration.userContentController removeScriptMessageHandlerForName:<span class="string">@"NativeMethod"</span>];</div></pre></td></tr></table></figure>
<p>ç°åœ¨ä¸‡äº‹ä¿±å¤‡ï¼Œåªæ¬ ä¸œé£äº†ã€‚å¯ä»¥çœ‹åˆ°WKScriptMessageHandlerçš„åè®®é‡Œé¢åªæœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œå°±æ˜¯ï¼š<code>- userContentController:didReceiveScriptMessage:</code>  </p>
<p>ç›¸ä¿¡èªæ˜çš„ä½ å·²ç»çŒœåˆ°äº†ã€‚æ˜¯çš„ï¼Œå°±æ˜¯åœ¨è¿™ä¸ªä»£ç†æ–¹æ³•é‡Œé¢æ“ä½œï¼šå¦‚æœJavaScriptæ‰§è¡Œå·²ç»å†™å¥½çš„ï¼šwindow.webkit.messageHandlers.NativeMethod.postMessage(â€œå°±æ˜¯ä¸€ä¸ªæ¶ˆæ¯å•Šâ€);è¿™è¡Œä»£ç ï¼Œè¿™ä¸ªä»£ç†æ–¹æ³•å°±ä¼šèµ°ï¼Œå¹¶ä¸”ä¼šæœ‰ä¸ªWKScriptMessageçš„å¯¹è±¡ï¼Œè¿™ä¸ªWKScriptMessageå¯¹è±¡æœ‰ä¸ªnameå±æ€§ï¼Œæ‹¿åˆ°ä¹‹åä½ ä¼šå‘ç°ï¼Œå°±æ˜¯æˆ‘ä»¬æ³¨å†Œçš„NativeMethodè¿™ä¸ªå­—ç¬¦ä¸²ï¼Œè¿™æ—¶å€™ä½ å°±å¯ä»¥æ‰‹åŠ¨è°ƒç”¨Nativeçš„æ–¹æ³•äº†ã€‚å¦‚æœæœ‰å¤šä¸ªæ–¹æ³•éœ€è¦è°ƒç”¨çš„è¯æ€ä¹ˆåŠï¼Œçœ‹åˆ°JavaScriptä¸­postMessage()æ–¹æ³•æœ‰ä¸€ä¸ªå‚æ•°äº†æ²¡æœ‰ï¼Œå¯ä»¥æ ¹æ®è¿™é‡Œçš„å‚æ•°æ¥åŒºåˆ†è°ƒç”¨åŸç”ŸAppçš„å“ªä¸ªæ–¹æ³•ã€‚</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)userContentController:(<span class="built_in">WKUserContentController</span> *)userContentController didReceiveScriptMessage:(<span class="built_in">WKScriptMessage</span> *)message &#123;</div><div class="line">        <span class="comment">// åˆ¤æ–­æ˜¯å¦æ˜¯è°ƒç”¨åŸç”Ÿçš„</span></div><div class="line">        <span class="keyword">if</span> ([<span class="string">@"NativeMethod"</span> isEqualToString:message.name]) &#123;</div><div class="line">            <span class="comment">// åˆ¤æ–­messageçš„å†…å®¹ï¼Œç„¶ååšç›¸åº”çš„æ“ä½œ</span></div><div class="line">            <span class="keyword">if</span> ([<span class="string">@"close"</span> isEqualToString:message.body]) &#123;</div><div class="line"></div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<h1 id="ç½‘é¡µæ”¯æŒæ»‘åŠ¨è¿”å›"><a href="#ç½‘é¡µæ”¯æŒæ»‘åŠ¨è¿”å›" class="headerlink" title="ç½‘é¡µæ”¯æŒæ»‘åŠ¨è¿”å›"></a>ç½‘é¡µæ”¯æŒæ»‘åŠ¨è¿”å›</h1><p>  WKWebViewæ¯”UIWebViewæœ‰å¾ˆå¤šä¼˜åŠ¿ï¼Œåœ¨WKWebViewä¸­é€šè¿‡è®¾ç½®ä¸€ä¸ªå±æ€§ <code>allowsBackForwardNavigationGestures</code> å°±å¯ä»¥å®ç°æ»‘åŠ¨è¿”å›ï¼Œè€ŒUIWebViewéœ€è¦å†™å¾ˆå¤šä»£ç æ¥è¾¾åˆ°æ»‘åŠ¨è¿”å›æ•ˆæœã€‚</p>
<p>é¡¹ç›®æœ€ä½æ”¯æŒiOS7ï¼Œæ‰€ä»¥åªèƒ½ä½¿ç”¨UIKitä¸­çš„UIWebViewï¼Œè€Œæ–°çš„WKWebViewæ˜¯æ”¯æŒiOS8+</p>
<ul>
<li>WKWebViewçš„å†…å­˜å¼€é”€è¦æ¯”UIWebViewå°å¾ˆå¤š</li>
<li>æ‹¥æœ‰é«˜è¾¾60FPSæ»šåŠ¨åˆ·æ–°ç‡åŠå†…ç½®æ‰‹åŠ¿</li>
<li>æ”¯æŒäº†æ›´å¤šçš„HTML5ç‰¹æ€§</li>
<li>htmlé¡µé¢å’ŒWKWebViewäº¤äº’æ›´æ–¹ä¾¿</li>
<li>Safariç›¸åŒçš„<code>JavaScript</code>å¼•æ“</li>
<li>æä¾›å¸¸ç”¨çš„å±æ€§ï¼Œå¦‚åŠ è½½ç½‘é¡µè¿›åº¦çš„å±æ€§estimatedProgress</li>
</ul>
<p><strong>å®ç°æ€è·¯ï¼š</strong>åœ¨UIWebViewçš„Delegateçš„shouldStartä»£ç†æ–¹æ³•ä¸­ï¼ŒæŠŠå½“å‰é¡µé¢æˆªä¸€å¼ å›¾ï¼ŒæŠŠè¿™å¼ æˆªå›¾å’Œå¯¹åº”çš„Urlä¿å­˜åˆ°ä¸€ä¸ªæ•°ç»„ä¸­ï¼Œåœ¨WebViewä¸ŠåŠ ä¸€ä¸ªUIPanGestureRecognizeræ‹–æ‹½æ‰‹åŠ¿ï¼Œåœ¨æ‰‹åŠ¿ä»£ç†æ–¹æ³•ä¸­ç›‘å¬çŠ¶æ€çš„å˜åŒ–ï¼Œå½“æ‰‹æŒ‡æ»‘åŠ¨æ—¶ï¼Œä¼šæŠŠå½“å‰çš„æˆªå›¾å’Œä¸Šä¸€é¡µæˆªå›¾ï¼Œæ ¹æ®æ‰‹åŠ¿çš„ç§»åŠ¨çš„ä½ç½®ï¼Œåšéšæ‰‹æŒ‡ç§»åŠ¨çš„åŠ¨ç”»ã€‚ç„¶åé‡æ–°è¯·æ±‚ä¸Šä¸€ä¸ªç½‘é¡µ<br>æµ‹è¯•è¿‡ç¨‹ä¸­å‘ç°ï¼Œæœ‰æ—¶æ»‘åŠ¨å¥½ä½¿æœ‰æ—¶ä¸å¥½ä½¿ï¼Œæœ€åäº†è§£åˆ°è¿™ä¸ª<code>Pan</code>æ‰‹åŠ¿å’ŒUIScrollviewçš„<code>Pan</code>æ‰‹åŠ¿ä¼šå†²çª</p>
<ol>
<li><p><code>[webpageView.scrollView.panGestureRecognizer requireGestureRecognizerToFail:_swipePanGesture];</code> è®¾ç½®å…ˆè¯†åˆ«æ»‘åŠ¨è¿”å›,åœ¨è¯†åˆ«æ»šåŠ¨çš„æ‰‹åŠ¿ï¼Œå¶å°”ä¼šé€ æˆæŸäº›ç½‘ç«™ç½‘é¡µï¼Œä¸èƒ½æ»šåŠ¨ã€‚</p>
</li>
<li><p>è®¾ç½®æ‰‹åŠ¿ä»£ç†æ–¹æ³• <code>- (BOOL)gestureRecognizer:(UIGestureRecognizer *)gestureRecognizer shouldRecognizeSimultaneouslyWithGestureRecognizer:(UIGestureRecognizer *)otherGestureRecognizer</code> è¿”å›YES,å…è®¸æ‰‹åŠ¿èƒ½åŒæ—¶è¯†åˆ«ã€‚å®Œç¾è§£å†³æ‰‹åŠ¿å†²çª</p>
</li>
</ol>
<hr>
<p>æ¬¢è¿æŒ‡æ­£ğŸ˜</p>
<h1 id="èµ„æ–™"><a href="#èµ„æ–™" class="headerlink" title="èµ„æ–™"></a>èµ„æ–™</h1><p><a href="http://www.jianshu.com/p/403853b63537" target="_blank" rel="external">WKWebViewä½¿ç”¨</a><br><a href="http://nshipster.cn/wkwebkit/" target="_blank" rel="external">WKWebâ€‹View(AFNä½œè€…)</a><br><a href="https://lvwenhan.com/ios/460.html" target="_blank" rel="external">è‡ªå·±åŠ¨æ‰‹æ‰“é€ åŸºäº WKWebView çš„æ··åˆå¼€å‘æ¡†æ¶</a>æ”¶è—ä¸€ä¸‹</p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;UIWebViewä¸JavaScriptäº¤äº’&quot;&gt;&lt;a href=&quot;#UIWebViewä¸JavaScriptäº¤äº’&quot; class=&quot;headerlink&quot; title=&quot;UIWebViewä¸JavaScriptäº¤äº’&quot;&gt;&lt;/a&gt;UIWebViewä¸JavaScript
    
    </summary>
    
    
      <category term="JavaScript" scheme="http://yoursite.com/tags/JavaScript/"/>
    
      <category term="Objective-C" scheme="http://yoursite.com/tags/Objective-C/"/>
    
  </entry>
  
  <entry>
    <title>WiresharkæŠ“åŒ…</title>
    <link href="http://yoursite.com/2017/04/23/Wireshark%E6%8A%93%E5%8C%85/"/>
    <id>http://yoursite.com/2017/04/23/WiresharkæŠ“åŒ…/</id>
    <published>2017-04-23T00:57:31.000Z</published>
    <updated>2017-07-05T16:56:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h1><p>ç½‘ç»œæŠ“åŒ…æ˜¯ä¸ªåŸºç¡€æŠ€èƒ½ï¼Œå¯¹äºç½‘ç»œåè®®çš„æŒæ¡æœ‰ä¸€å®šçš„è¦æ±‚ã€‚iOSä¸Šå®ç°ç½‘ç»œæŠ“åŒ…å¯ä»¥ç”¨Charlesï¼ˆé’ˆå¯¹httpå’Œhttpsï¼‰ï¼Œtcpdumpï¼ˆå¿«é€Ÿåˆ†æç½‘ç»œåŒ…ï¼‰ï¼Œå’ŒWireshareã€‚å’Œtcpdumpç›¸æ¯”ï¼ŒWiresharkæä¾›ä¸°å¯Œçš„GUIäº¤äº’ï¼Œè€Œä¸”èƒ½åˆ†ææ‰€æœ‰çš„ç½‘ç»œåè®®ã€‚</p>
<ol>
<li>é¦–å…ˆå®‰è£…è½¯ä»¶ <a href="https://www.wireshark.org/download.html" target="_blank" rel="external">å®˜ç½‘ä¸‹è½½</a>ï¼Œç›®å‰æœ€æ–°ç‰ˆæœ¬v2.2.7</li>
</ol>
<p>æ‰“å¼€ä¸»ç•Œé¢<br><img src="https://ws2.sinaimg.cn/large/006tNbRwly1fh96jrkh8tj31kw180tix.jpg" alt="Wiresharkä¸»ç•Œé¢"><br>Wiresharkåœ¨ç¬¬ä¸€ä¸ªç•Œé¢å°±æŠŠå½“å‰ç³»ç»Ÿæ‰€åŒ…å«çš„ç½‘å¡åˆ—å‡ºæ¥äº†ï¼Œç›´æ¥ç‚¹å‡»ä»»ä½•ä¸€é¡¹å°±å¯ä»¥å¼€å§‹ç›‘å¬é€šè¿‡è¯¥ç½‘å¡çš„æ‰€æœ‰ç½‘ç»œæµé‡ã€‚   </p>
<h1 id="RVIæ¥å£åˆ›å»ºå’Œç®¡ç†"><a href="#RVIæ¥å£åˆ›å»ºå’Œç®¡ç†" class="headerlink" title="RVIæ¥å£åˆ›å»ºå’Œç®¡ç†"></a>RVIæ¥å£åˆ›å»ºå’Œç®¡ç†</h1><p>å½“æˆ‘ä»¬æŠŠiPhoneé€šè¿‡usbè¿æ¥macbookæ—¶ï¼ŒWiresharkå¹¶ä¸èƒ½ç›´æ¥ç›‘å¬é€šè¿‡iPhoneçš„ç½‘ç»œæµé‡ï¼Œéœ€è¦é€šè¿‡ä¸€ä¸ªç³»ç»Ÿç¨‹åºåœ¨æˆ‘ä»¬çš„Macç³»ç»Ÿä¸Šï¼Œå»ºç«‹ä¸€ä¸ªæ˜ å°„åˆ°iPhoneçš„è™šæ‹Ÿç½‘å¡  </p>
<ol>
<li>é€šè¿‡æ•°æ®çº¿è¿æ¥å¥½iOSè®¾å¤‡ï¼Œæ‹¿åˆ°è®¾å¤‡çš„UDIDï¼ˆXcodeæˆ–iTuneséƒ½è¡Œï¼‰</li>
<li>terminalè¾“å…¥å‘½ä»¤ï¼Œæ ¼å¼æ˜¯<code>rvictl -s è®¾å¤‡UDID</code> </li>
</ol>
<p>æ‰§è¡Œå‘½ä»¤ä¹‹åWiresharkèƒ½ç«‹å³è¯†åˆ«æ–°å¢åŠ çš„rvi0ç½‘å¡ï¼Œä¹Ÿå°±æ˜¯ä¸Šå›¾ä¸­é«˜äº®çš„éƒ¨åˆ†ï¼ŒåŒå‡»rvi0è¿™ä¸€é¡¹ï¼ŒWireshareå³è¿›å…¥å¦‚ä¸‹ç•Œé¢å¼€å§‹ç›‘å¬iPhoneè®¾å¤‡ä¸Šçš„æ‰€æœ‰æµé‡ã€‚</p>
<ul>
<li>Androidæ‰‹æœºï¼Œå¯ä»¥ä¸‹è½½ä¸ª<code>PacketCaptrue</code>è½¯ä»¶ï¼Œç”¨äºæŠ“åŒ…</li>
</ul>
<p>å¦‚æœå‡ºç°ä¸‹å›¾é”™è¯¯ï¼Œè¯·ç”¨åœ¨ç»ˆç«¯ç”¨ <code>sudo wireshark</code> å‘½ä»¤å¯åŠ¨<br><img src="https://ws1.sinaimg.cn/large/006tNbRwly1fh9cvfmggej30es08lmy7.jpg" alt="error"></p>
<h1 id="ç½‘ç»œåŒ…ç»“æ„"><a href="#ç½‘ç»œåŒ…ç»“æ„" class="headerlink" title="ç½‘ç»œåŒ…ç»“æ„"></a>ç½‘ç»œåŒ…ç»“æ„</h1><p>ç»å…¸çš„TCP/IPäº”å±‚ç»“æ„:</p>
<ul>
<li>åº”ç”¨å±‚</li>
<li>ä¼ è¾“å±‚  </li>
<li>ç½‘ç»œå±‚</li>
<li>æ•°æ®é“¾è·¯å±‚</li>
<li>ç‰©ç†å±‚</li>
</ul>
<p>åº”ç”¨å±‚æ˜¯æœ€å†…å±‚çš„payloadï¼Œé™¤äº†åº”ç”¨å±‚è¿™ä¸€å±‚ä¹‹å¤–ï¼Œå…¶ä»–å±‚éƒ½æ˜¯ç”¨è‡ªå·±è¿™ä¸€å±‚çš„åè®®header+æ‰€åŒ…å«é‚£ä¸€å±‚çš„payloadã€‚å¯ä»¥ç”¨å¦‚ä¸‹å…¬å¼è¡¨ç¤ºï¼š<br>TCP Layer = TCP Header + Application Payload<br>IP Layer = IP Header + TCP Payload<br>â€¦</p>
<h1 id="ä½¿ç”¨Filterè¿‡æ»¤åŒ…"><a href="#ä½¿ç”¨Filterè¿‡æ»¤åŒ…" class="headerlink" title="ä½¿ç”¨Filterè¿‡æ»¤åŒ…"></a>ä½¿ç”¨Filterè¿‡æ»¤åŒ…</h1><p>ä½¿ç”¨Wiresharkå’Œä½¿ç”¨Charlesæœ€å¤§çš„åŒºåˆ«åœ¨äºï¼ŒCharlesåªæ•è·HTTPæµé‡ï¼Œè€ŒWiresharkæ•æ‰çš„æ˜¯ç»è¿‡ç›®æ ‡ç½‘å¡æ‰€æœ‰çš„æµé‡ï¼Œæµé‡åŒ…å¯ä»¥åœ¨å‡ ç§’å†…è†¨èƒ€åˆ°éš¾ä»¥é˜…è¯»çš„æ•°é‡ï¼Œæ‰€ä»¥æ­¤æ—¶æˆ‘ä»¬éœ€è¦ä½¿ç”¨Filteræ¥åšåŒ…çš„è¿‡æ»¤ï¼ŒFilterè§„åˆ™å®šçš„è¶Šç»†ï¼Œå‰”é™¤æ‰çš„å¹²æ‰°ä¿¡æ¯å°±è¶Šå¤šï¼Œåˆ†æèµ·æ¥å°±è¶Šå¿«ã€‚</p>
<p>Wiresharkçš„Filteråˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§ä¸ºCapture Filterï¼Œå¦ä¸€ç§æ˜¯Display Filterã€‚ </p>
<ul>
<li><p>Capture Filterå‡ºç°åœ¨åˆå§‹ç•Œé¢ï¼Œåœ¨ç½‘å¡åˆ—è¡¨çš„ä¸Šæ–¹æœ‰ä¸ªè¾“å…¥æ¡†ï¼Œå…è®¸æˆ‘ä»¬è¾“å…¥capture filterï¼Œä¸€æ—¦è¾“å…¥äº†ç‰¹å®šçš„captureè§„åˆ™ï¼ŒWiresharkå°±åªæ•è·ç¬¦åˆè¯¥è§„åˆ™çš„æµé‡åŒ…äº†ã€‚</p>
</li>
<li><p>Display Filterå‡ºç°åœ¨æµé‡ç›‘æ§ç•Œé¢ï¼Œåœ¨å·¥å…·æ çš„ä¸‹æ–¹æœ‰ä¸ªè¾“å…¥æ¡†ï¼Œå…è®¸æˆ‘ä»¬è¾“å…¥display filterï¼Œdisplay filteråªæ˜¯ä»ç•Œé¢ä¸Šè¿‡æ»¤æ‰ä¸ç¬¦åˆè§„åˆ™çš„åŒ…ï¼ŒWiresharkå®é™…ä¸Šè¿˜æ˜¯ç›‘å¬äº†è¿™äº›åŒ…ï¼Œä¸€æ—¦å»æ‰display filterï¼Œæ‰€æœ‰çš„åŒ…åˆä¼šå‡ºç°åœ¨åŒä¸€ç•Œé¢ã€‚<br><img src="https://ws4.sinaimg.cn/large/006tNbRwly1fh9grjnf2wj30um0bcdio.jpg" alt="Display Filter"></p>
</li>
</ul>
<p>è¯­æ³•è§„åˆ™å¯ä»¥æŸ¥çœ‹<a href="https://www.wireshark.org/docs/wsug_html_chunked/ChWorkBuildDisplayFilterSection.html" target="_blank" rel="external">Wiresharkå®˜æ–¹æ–‡æ¡£</a></p>
<h1 id="æµé‡è·Ÿè¸ª"><a href="#æµé‡è·Ÿè¸ª" class="headerlink" title="æµé‡è·Ÿè¸ª"></a>æµé‡è·Ÿè¸ª</h1><p>Wiresharké»˜è®¤æƒ…å†µä¸‹å°†ä¸åŒç½‘ç»œè¿æ¥çš„æµé‡éƒ½æ··åœ¨ä¸€èµ·å±•ç¤ºï¼Œå³ä½¿ç»™ä¸åŒåè®®çš„åŒ…ä¸Šè‰²ä¹‹åï¼Œè¦å•ç‹¬æŸ¥çœ‹æŸä¸ªç‰¹å®šè¿æ¥çš„æµé‡ä¾ç„¶ä¸æ€ä¹ˆæ–¹ä¾¿ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡Wiresharkæä¾›çš„ä¸¤ç§æ–¹å¼æ¥å®ç°è¿™ä¸ªç›®æ ‡ã€‚</p>
<h2 id="Follow-Stream"><a href="#Follow-Stream" class="headerlink" title="Follow Stream"></a>Follow Stream</h2><p>å½“æˆ‘ä»¬é€‰ä¸­æŸä¸ªåŒ…ä¹‹åï¼Œå³é”®å¼¹å‡ºçš„èœå•é‡Œï¼Œæœ‰ä¸ªé€‰é¡¹å…è®¸æˆ‘ä»¬å°†å½“å‰åŒ…æ‰€å±äºçš„å®Œæ•´æµé‡å•ç‹¬åˆ—å‡ºæ¥ï¼Œå¦‚<br><img src="https://ws1.sinaimg.cn/large/006tNbRwly1fh9ha85spnj31bc0u24da.jpg" alt="TCPè¿½è¸ªæµ"></p>
<h2 id="Flow-Graph"><a href="#Flow-Graph" class="headerlink" title="Flow Graph"></a>Flow Graph</h2><p>Flow Graphå¯ä»¥é€šè¿‡èœå•Statistics-&gt;Flow Graphæ¥ç”Ÿæˆï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥å¾—åˆ°å¦ä¸€ç§å½¢å¼çš„æµé‡å‘ˆç°</p>
<p>å’ŒFollow Streamä¸åŒçš„æ˜¯æˆ‘ä»¬è·å–åˆ°çš„æ˜¯å®Œæ•´çš„æµé‡ï¼ŒiPhoneæ‰‹æœºIPåœ°å€å‘å‡ºçš„æµå‘å¤šä¸ªæœåŠ¡å™¨çš„ç½‘ç»œæµé‡ï¼ŒåŒ…æ‹¬DNSè§£æå’ŒSSLå®‰å…¨æ¡æ‰‹ç­‰ã€‚å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ä¸Šå›¾ä¸­ä¸‹æ–¹çš„æ“ä½œåŒºåŸŸåšè¿›ä¸€æ­¥çš„è¿‡æ»¤ï¼Œå¯ä»¥ä½¿ç”¨Display Filteråšè¿›ä¸€æ­¥çš„æµé‡å®šä½ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;ä»‹ç»&quot;&gt;&lt;a href=&quot;#ä»‹ç»&quot; class=&quot;headerlink&quot; title=&quot;ä»‹ç»&quot;&gt;&lt;/a&gt;ä»‹ç»&lt;/h1&gt;&lt;p&gt;ç½‘ç»œæŠ“åŒ…æ˜¯ä¸ªåŸºç¡€æŠ€èƒ½ï¼Œå¯¹äºç½‘ç»œåè®®çš„æŒæ¡æœ‰ä¸€å®šçš„è¦æ±‚ã€‚iOSä¸Šå®ç°ç½‘ç»œæŠ“åŒ…å¯ä»¥ç”¨Charlesï¼ˆé’ˆå¯¹httpå’Œhttpsï¼‰ï¼Œtcpdumpï¼ˆ
    
    </summary>
    
    
      <category term="Wireshark" scheme="http://yoursite.com/tags/Wireshark/"/>
    
      <category term="æŠ“åŒ…" scheme="http://yoursite.com/tags/%E6%8A%93%E5%8C%85/"/>
    
  </entry>
  
  <entry>
    <title>Swifté—­åŒ…</title>
    <link href="http://yoursite.com/2017/03/05/Swift%E9%97%AD%E5%8C%85/"/>
    <id>http://yoursite.com/2017/03/05/Swifté—­åŒ…/</id>
    <published>2017-03-05T00:06:13.000Z</published>
    <updated>2017-07-05T00:45:43.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="é—­åŒ…æ¦‚å¿µ"><a href="#é—­åŒ…æ¦‚å¿µ" class="headerlink" title="é—­åŒ…æ¦‚å¿µ"></a>é—­åŒ…æ¦‚å¿µ</h1><p><strong>é—­åŒ…</strong>æ˜¯å¯ä»¥åœ¨ä½ çš„ä»£ç ä¸­è¢«ä¼ é€’å’Œå¼•ç”¨çš„åŠŸèƒ½æ€§ç‹¬ç«‹æ¨¡å—ã€‚Swift ä¸­çš„é—­åŒ…å’Œ C ä»¥åŠ Objective-C ä¸­çš„ blocks å¾ˆåƒï¼Œè¿˜æœ‰å…¶ä»–è¯­è¨€ä¸­çš„åŒ¿åå‡½æ•°ä¹Ÿç±»ä¼¼ã€‚<br>åœ¨Swiftä¸­ï¼Œæä¾›ä¸‰ç±»é—­åŒ…ï¼š</p>
<ul>
<li>å…¨å±€å‡½æ•°æ˜¯ä¸€ä¸ªæœ‰åå­—ä½†ä¸ä¼šæ•è·ä»»ä½•å€¼çš„é—­åŒ…ã€‚</li>
<li>åµŒå¥—ï¼ˆå†…åµŒï¼‰å‡½æ•°æ˜¯ä¸€ä¸ªæœ‰åå­—å¹¶å¯ä»¥æ•è·åˆ°å…¶å°é—­å‡½æ•°åŸŸå†…çš„å€¼çš„é—­åŒ…ã€‚</li>
<li>é—­åŒ…è¡¨è¾¾å¼æ˜¯ä¸€ä¸ªåˆ©ç”¨è½»é‡çº§è¯­æ³•æ‰€å†™çš„ï¼Œå¯ä»¥æ•è·å…¶ä¸Šä¸‹æ–‡ä¸­å˜é‡æˆ–å¸¸é‡å€¼çš„åŒ¿åé—­åŒ…ã€‚ </li>
</ul>
<h1 id="é—­åŒ…è¡¨è¾¾å¼"><a href="#é—­åŒ…è¡¨è¾¾å¼" class="headerlink" title="é—­åŒ…è¡¨è¾¾å¼"></a>é—­åŒ…è¡¨è¾¾å¼</h1><p>é—­åŒ…è¡¨è¾¾å¼è¯­æ³•å¯ä»¥ä½¿ç”¨å¸¸é‡ã€å˜é‡å’Œinoutç±»å‹ä½œä¸ºå‚æ•°ï¼Œä¸æä¾›é»˜è®¤å€¼ã€‚ ä¹Ÿå¯ä»¥åœ¨å‚æ•°åˆ—è¡¨çš„æœ€åä½¿ç”¨å¯å˜å‚æ•°ã€‚ å…ƒç»„ä¹Ÿå¯ä»¥ä½œä¸ºå‚æ•°å’Œè¿”å›å€¼ã€‚</p>
<p>é—­åŒ…è¡¨è¾¾å¼è¯­æ³•çš„ä¸€èˆ¬å½¢å¼ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123; (parameters) -&gt; (<span class="keyword">return</span> type) <span class="keyword">in</span></div><div class="line">    statements</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<ul>
<li>å…³é”®å­— in æ¥åŒºåˆ†é—­åŒ…çš„å¤´å’Œé—­åŒ…å‡½æ•°ä½“ã€‚</li>
</ul>
<p>Swift çš„æ ‡å‡†åº“æä¾›äº†ä¸€ä¸ªå«åš sorted(by:) çš„æ–¹æ³•ï¼Œä¼šæ ¹æ®ä½ æä¾›çš„æ’åºé—­åŒ…å°†å·²çŸ¥ç±»å‹çš„æ•°ç»„çš„å€¼è¿›è¡Œæ’åºã€‚ä½¿ç”¨sortedæ–¹æ³•å¯¹é—­åŒ…ç®€åŒ–<br>ä¾‹å­ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">let names = ["Chris","Ewa","Barry","Daniellaâ€]`</div><div class="line">// æ™®é€šå‡½æ•°</div><div class="line">func backward(_ s1: String, _ s2: String) -&gt; Bool &#123;</div><div class="line">    return s1 &gt; s2</div><div class="line">&#125;</div><div class="line">var reversedNames = names.sorted(by: backward)</div><div class="line"></div><div class="line">// ä½¿ç”¨é—­åŒ…è¡¨è¾¾å¼</div><div class="line">reversedNames = names.sorted(by: &#123; (s1: String, s2: String) -&gt; Bool in</div><div class="line">    return s1 &gt; s2</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>ç±»å‹æ¨æ–­ï¼ˆå› æ’åºé—­åŒ…ä¸ºå®é™…å‚æ•°æ¥ä¼ é€’ç»™å‡½æ•°ï¼Œæ•… Swift èƒ½æ¨æ–­å®ƒçš„å½¢å¼å‚æ•°ç±»å‹å’Œè¿”å›ç±»å‹ã€‚ï¼‰</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">reversedNames = names.sorted(by: &#123; s1, s2 <span class="keyword">in</span> <span class="keyword">return</span> s1 &gt; s2 &#125; )</div></pre></td></tr></table></figure>
<p>ä»å•è¡¨è¾¾å¼é—­åŒ…éšå¼è¿”å›ï¼Œreturn å…³é”®å­—èƒ½å¤Ÿè¢«çœç•¥<br><code>reversedNames = names.sorted(by: { s1, s2 in s1 &gt; s2 } )</code><br>ç®€å†™çš„å®é™…å‚æ•°å<br><code>reversedNames = names.sorted(by: { $0 &gt; $1 } )</code><br>è¿˜æœ‰ä¸€ç§æ›´åŠ ç®€åŒ–çš„å½¢å¼ï¼Œç›´æ¥ä½¿ç”¨æ“ä½œç¬¦&gt;,å¯ä»¥å†™å‡ºè¿™æ ·çš„å‰ææ˜¯é—­åŒ…å®šä¹‰åˆšå¥½å’Œæ“ä½œç¬¦çš„å®šä¹‰å»åˆã€‚<br><code>reversedNames = names.sorted(by: &gt;)</code></p>
<h1 id="é€ƒé€¸å’Œéé€ƒé€¸é—­åŒ…"><a href="#é€ƒé€¸å’Œéé€ƒé€¸é—­åŒ…" class="headerlink" title="é€ƒé€¸å’Œéé€ƒé€¸é—­åŒ…"></a>é€ƒé€¸å’Œéé€ƒé€¸é—­åŒ…</h1><p>Swift çš„é—­åŒ…åˆ†ä¸º é€ƒé€¸ ä¸ éé€ƒé€¸ ä¸¤ç§ã€‚ä¸€ä¸ªæ¥å—é€ƒé€¸é—­åŒ…ä½œä¸ºå‚æ•°çš„å‡½æ•°ï¼Œé€ƒé€¸é—­åŒ…ï¼ˆå¯èƒ½ï¼‰ä¼šåœ¨å‡½æ•°è¿”å›ä¹‹åæ‰è¢«è°ƒç”¨â€”â€”â€”â€”ä¹Ÿå°±æ˜¯è¯´ï¼Œé—­åŒ…é€ƒç¦»äº†å‡½æ•°çš„ä½œç”¨åŸŸã€‚</p>
<p>é€ƒé€¸é—­åŒ…é€šå¸¸ä¸å¼‚æ­¥æ§åˆ¶æµç›¸å…³è”ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š  </p>
<ul>
<li>ä¸€ä¸ªå‡½æ•°å¼€å¯äº†ä¸€ä¸ªåå°ä»»åŠ¡åç«‹å³è¿”å›ï¼Œç„¶åé€šè¿‡ä¸€ä¸ªå®Œæˆå›è°ƒï¼ˆcompletion handlerï¼‰æŠ¥å‘Šåå°ä»»åŠ¡çš„ç»“æœã€‚</li>
<li>ä¸€ä¸ªè§†å›¾ç±»æŠŠã€æŒ‰é’®ç‚¹å‡»äº‹ä»¶æ‰§è¡Œçš„æ“ä½œã€å°è£…æˆä¸€ä¸ªé—­åŒ…ï¼Œå¹¶å­˜å‚¨ä¸ºè‡ªèº«çš„å±æ€§ã€‚æ¯æ¬¡ç”¨æˆ·ç‚¹å‡»æŒ‰é’®æ—¶ï¼Œéƒ½ä¼šè°ƒç”¨è¯¥é—­åŒ…ã€‚é—­åŒ…ä¼šé€ƒç¦»å±æ€§çš„è®¾ç½®å™¨ï¼ˆsetterï¼‰ã€‚</li>
<li>ä½ ä½¿ç”¨ <code>DispatchQueue.async</code> åœ¨æ´¾å‘é˜Ÿåˆ—ï¼ˆdispatch queueï¼‰ä¸Šå®‰æ’äº†ä¸€ä¸ªå¼‚æ­¥æ‰§è¡Œçš„ä»»åŠ¡ã€‚è¿™ä¸ªé—­åŒ…ä»»åŠ¡çš„ç”Ÿå‘½å‘¨æœŸä¼šæ¯” async çš„ä½œç”¨åŸŸæ´»å¾—æ›´é•¿ä¹…ã€‚<br>ä¸ä¹‹å¯¹åº”çš„ <code>DispatchQueue.sync</code>ï¼Œå®ƒä¼šä¸€ç›´ç­‰åˆ°ä»»åŠ¡é—­åŒ…æ‰§è¡Œå®Œæ¯•åæ‰è¿”å›â€”â€”é—­åŒ…æ°¸è¿œä¸ä¼šé€ƒé€¸ã€‚map ä»¥åŠæ ‡å‡†åº“ä¸­å…¶ä»–çš„åºåˆ—å’Œæ•°ç»„çš„ç®—æ³•ä¹Ÿæ˜¯éé€ƒé€¸çš„ã€‚</li>
</ul>
<h2 id="ä¸ºä»€ä¹ˆåŒºåˆ†é—­åŒ…çš„é€ƒé€¸æ€§å’Œéé€ƒé€¸æ€§å¦‚æ­¤é‡è¦"><a href="#ä¸ºä»€ä¹ˆåŒºåˆ†é—­åŒ…çš„é€ƒé€¸æ€§å’Œéé€ƒé€¸æ€§å¦‚æ­¤é‡è¦" class="headerlink" title="ä¸ºä»€ä¹ˆåŒºåˆ†é—­åŒ…çš„é€ƒé€¸æ€§å’Œéé€ƒé€¸æ€§å¦‚æ­¤é‡è¦"></a>ä¸ºä»€ä¹ˆåŒºåˆ†é—­åŒ…çš„é€ƒé€¸æ€§å’Œéé€ƒé€¸æ€§å¦‚æ­¤é‡è¦</h2><p>ç®€å•æ¥è¯´ï¼Œæ˜¯ä¸ºäº†ç®¡ç†å†…å­˜ã€‚ä¸€ä¸ªé—­åŒ…ä¼šå¼ºå¼•ç”¨å®ƒæ•è·çš„æ‰€æœ‰å¯¹è±¡â€”â€”â€”â€”å¦‚æœä½ åœ¨é—­åŒ…ä¸­è®¿é—®äº†å½“å‰å¯¹è±¡ä¸­çš„ä»»æ„å±æ€§æˆ–å®ä¾‹æ–¹æ³•ï¼Œé—­åŒ…ä¼šæŒæœ‰å½“å‰å¯¹è±¡ï¼Œå› ä¸ºè¿™äº›æ–¹æ³•å’Œå±æ€§éƒ½éšæ€§åœ°æºå¸¦äº†ä¸€ä¸ª self å‚æ•°ã€‚<br>è¿™ç§æ–¹å¼å¾ˆå®¹æ˜“å¯¼è‡´å¾ªç¯å¼•ç”¨ï¼Œè¿™è§£é‡Šäº†ä¸ºä»€ä¹ˆç¼–è¯‘å™¨ä¼šè¦æ±‚ä½ åœ¨é—­åŒ…ä¸­æ˜¾å¼åœ°å†™å‡ºå¯¹ self çš„å¼•ç”¨ã€‚è¿™è¿«ä½¿ä½ è€ƒè™‘æ½œåœ¨çš„å¾ªç¯å¼•ç”¨ï¼Œå¹¶ä½¿ç”¨æ•è·åˆ—è¡¨æ‰‹åŠ¨å¤„ç†ã€‚<br>ç„¶è€Œï¼Œä½¿ç”¨éé€ƒé€¸çš„é—­åŒ…ä¸ä¼šäº§ç”Ÿå¾ªç¯å¼•ç”¨â€”â€”â€”â€”ç¼–è¯‘å™¨å¯ä»¥ä¿è¯åœ¨å‡½æ•°è¿”å›æ—¶é—­åŒ…ä¼šé‡Šæ”¾å®ƒæ•è·çš„æ‰€æœ‰å¯¹è±¡ã€‚å› æ­¤ï¼Œç¼–è¯‘å™¨åªè¦æ±‚åœ¨é€ƒé€¸é—­åŒ…ä¸­æ˜ç¡®å¯¹ self çš„å¼ºå¼•ç”¨ã€‚æ˜¾ç„¶ï¼Œä½¿ç”¨éé€ƒé€¸é—­åŒ…æ˜¯ä¸€ä¸ªæ›´åŠ æ„‰æ‚¦çš„æ–¹æ¡ˆã€‚</p>
<ul>
<li>ä» Swift 3.0 å¼€å§‹ï¼Œéé€ƒé€¸é—­åŒ…å˜æˆäº†é—­åŒ…å‚æ•°çš„é»˜è®¤å½¢å¼ã€‚å¦‚æœä½ æƒ³å…è®¸ä¸€ä¸ªé—­åŒ…å‚æ•°é€ƒé€¸ï¼Œéœ€è¦ç»™è¿™ä¸ªç±»å‹å¢åŠ ä¸€ä¸ª @escaping çš„æ ‡æ³¨ã€‚</li>
</ul>
<h2 id="è§£å†³é—­åŒ…å¾ªç¯å¼•ç”¨"><a href="#è§£å†³é—­åŒ…å¾ªç¯å¼•ç”¨" class="headerlink" title="è§£å†³é—­åŒ…å¾ªç¯å¼•ç”¨"></a>è§£å†³é—­åŒ…å¾ªç¯å¼•ç”¨</h2><p>è§£å†³é—­åŒ…çš„å¾ªç¯å¼ºå¼•ç”¨<br>Swift æä¾›äº†ä¸€ç§ä¼˜é›…çš„æ–¹æ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç§°ä¹‹ä¸ºé—­åŒ…æ•è·åˆ—è¡¨ï¼ˆ closuer capture list ï¼‰<br>æ•è·åˆ—è¡¨ä¸­çš„æ¯ä¸€é¡¹éƒ½ç”± weak æˆ– unowned å…³é”®å­—ä¸ç±»å®ä¾‹çš„å¼•ç”¨ï¼ˆå¦‚ self ï¼‰æˆå¯¹ç»„æˆ</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">lazy</span> <span class="keyword">var</span> someClosure: (<span class="type">Int</span>, <span class="type">String</span>) -&gt; <span class="type">String</span> = &#123;</div><div class="line">    [<span class="keyword">unowned</span> <span class="keyword">self</span>, <span class="keyword">weak</span> delegate = <span class="keyword">self</span>.delegate!] (index: <span class="type">Int</span>, stringToProcess: <span class="type">String</span>) -&gt; <span class="type">String</span> <span class="keyword">in</span></div><div class="line">    <span class="comment">// closure body goes here</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><p><a href="http://swift.gg/2016/11/15/optional-non-escaping-closures/" target="_blank" rel="external">é—­åŒ…é€ƒé€¸å’Œéé€ƒé€¸</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;é—­åŒ…æ¦‚å¿µ&quot;&gt;&lt;a href=&quot;#é—­åŒ…æ¦‚å¿µ&quot; class=&quot;headerlink&quot; title=&quot;é—­åŒ…æ¦‚å¿µ&quot;&gt;&lt;/a&gt;é—­åŒ…æ¦‚å¿µ&lt;/h1&gt;&lt;p&gt;&lt;strong&gt;é—­åŒ…&lt;/strong&gt;æ˜¯å¯ä»¥åœ¨ä½ çš„ä»£ç ä¸­è¢«ä¼ é€’å’Œå¼•ç”¨çš„åŠŸèƒ½æ€§ç‹¬ç«‹æ¨¡å—ã€‚Swift ä¸­çš„é—­åŒ…å’Œ C ä»¥åŠ Ob
    
    </summary>
    
    
      <category term="Swift" scheme="http://yoursite.com/tags/Swift/"/>
    
      <category term="é—­åŒ…" scheme="http://yoursite.com/tags/%E9%97%AD%E5%8C%85/"/>
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="http://yoursite.com/2017/01/02/hello-world/"/>
    <id>http://yoursite.com/2017/01/02/hello-world/</id>
    <published>2017-01-02T15:52:46.000Z</published>
    <updated>2017-01-02T15:52:46.000Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo new <span class="string">"My New Post"</span></div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo server</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo generate</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo deploy</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Welcome to &lt;a href=&quot;https://hexo.io/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Hexo&lt;/a&gt;! This is your very first post. Check &lt;a href=&quot;https://hexo.
    
    </summary>
    
    
  </entry>
  
</feed>
